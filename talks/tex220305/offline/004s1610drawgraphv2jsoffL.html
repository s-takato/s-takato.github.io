<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    
    <title>004s1610drawgraphv2.cdy</title>
    <style type="text/css">
        * {
            margin: 0px;
            padding: 0px;
        }

        #CSConsole {
            background-color: #FAFAFA;
            border-top: 1px solid #333333;
            bottom: 0px;
            height: 200px;
            overflow-y: scroll;
            position: fixed;
            width: 100%;
        }
    </style>
    <link rel="stylesheet" href="ketcindyjs/CindyJS.css">
   <script type="text/javascript" src="ketcindyjs/Cindy.js"></script>

<script id="csinit" type="text/x-cindyscript">
Invert(x):=reverse(x);
Strsplit(str,key):=( //180505
  regional(start,out,tmp1,tmp2);
  tmp1=Indexall(str,key);
  out=[]; start=0;
  forall(tmp1,
    out=append(out,substring(str,start,#-1));
    start=#;
  );
  out=append(out,substring(str,start,length(str)));
  out;
);
Indexall(str,key):=(
  regional(rest,out,flg,tmp,tmp1,);
  out=[];
  rest=str;
  flg=0;
  forall(1..(length(str)),
    if(flg==0,
      tmp=indexof(rest,key);
      if(tmp>0,
        tmp1=tmp+length(str)-length(rest);
        out=append(out,tmp1);
        rest=substring(rest,tmp,length(rest));
      ,
        flg=1;
      );
    );
  );
  out;
);
Toupper(str):=(
  regional(alphabet,out,tmp,tmp1);
  alphabet="abcdefghijklmnopqrstuvwxyz";
  out="";
  forall(1..(length(str)),
    tmp=substring(str,#-1,#);
    tmp1=indexof(alphabet,tmp);
    if(tmp1>0,
      out=out+unicode(text(tmp1+64),base->10);
    ,
      out=out+tmp;
    );
  );
  out;
);
Ketinit():=Ketinit("fig",0.3); //190831from
Ketinit(Arg):=(//181001from
  if(isstring(Arg),
    Ketinit(Arg,0.3);
  ,
    Ketinit("fig",Arg);
  );
);
Ketinit(work,strictsep):=( //200509
 regional(pt,tmp,tmp1,tmp2,letterc,boxc,shadowc,mboxc);
  PenThickInit=8;
  ULEN="1cm";
  MEMORI=0.05;//18.01.15from
  MEMORIInit=MEMORI;
  MEMORINow=MEMORI;
  MARKLEN=0.05;
  MARKLENInit=MARKLEN; //180504
  MARKLENNow= MARKLEN;
  GENTEN=[0,0];//18.01.15to
  TABLECOUNT=0; //190428
  KETPICLAYER=20;
  MilliIn=1/2.54*1000;
  PenThick=round(MilliIn*0.02);
  PenThickInit=PenThick;
  TenSizeInit=0.02;
  TenSize=TenSizeInit;
  YaSize=1; YaAngle=18; YaPosition=1;
  YaCut=0.2; //191203
  YasenStyle="dr,1"; Yajiristyle="tf";
  KETPICCOUNT=1;
  KCOLOR=[0,0,0,1]; //200513,200618
  GLIST=[]; //201005rechanged
  GCLIST=[]; //201005rechanged
  if(!islist(VLISTadd),VLIST=[],VLIST=VLISTadd); //200123
  if(!islist(FUNLISTadd),FUNLIST=[],FUNLIST=FUNLISTadd); //200123
  LETTERlist=[];
  ADDAXES="1";
  AXSTYLE=[["l","x","e","y","n","O","sw","","",""],[]]; //190901
  AXCOUNT=1; //181215
  SHADECTR=1; //190222
  LFmark=unicode("000a"); Bs=unicode("005c");
  CRmark=unicode("000d");//16.12.13
  Dq=unicode("0022");
  Fnametex=Fhead+".tex";
  FnameR=Fhead+".r";
  FnamebodyR=Fhead+"body.r";
  Fnameout=Fhead+".txt";  // 17.10.13to
  ArrowlineNumber=1;  // 15.01.05
  ArrowheadNumber=1;
  BezierNumber=1; //15.01.03
  SCALEX=1;
  SCALEY=1;
  XMIN=-5;
  XMAX=5;
  YMIN=-5;
  YMAX=5;
  StrictSep=strictsep; //190831
  Setwindow("Msg=n"); // 16.05.31
  forall(remove(allpoints(),[SW,NE]),
    Strictmove(#.name);
    Ptpos(#,#.xy); //200529
  ); //190917
);
Setwindow():=Setwindow("Msg=y");
Setwindow(str):=(
  regional(tmp,tmp1,tmp2,msg);
  msg="Y";
  tmp=indexof(str,"="); // 16.02.10
  msg=Toupper(substring(str,tmp,tmp+1));
  Strictmove("SW"); Strictmove("NE");//190927
  if((ispoint(SW)) & (ispoint(NE)),
    tmp1=LLcrd(Ptpos(SW));//190912[2lines]
    tmp2=LLcrd(Ptpos(NE));
    XMIN=tmp1_1; XMAX=tmp2_1;
    YMIN=tmp1_2; YMAX=tmp2_2;
  ,
    if(!ispoint(SW), //191005from
      Putpoint("SW",Pcrd([-5,-5]));
      XMIN=-5; YMIN=-5;
      Ptpos(SW,SW.xy);
    );
    if(!ispoint(NE),
      Putpoint("NE", Pcrd([5,5]));
      XMAX=5; YMAX=5;
      Ptpos(NE,NE.xy);
    ); //191005to
  );
);
Setwindow(xrange,yrange):=Setwindow(xrange,yrange,"Msg=y");
Setwindow(xrange,yrange,msg):=(
  XMIN=xrange_1;
  XMAX=xrange_2;
  YMIN=yrange_1;
  YMAX=yrange_2;
  Ptpos(SW,Pcrd([XMIN,YMIN])); //190927from
  Ptpos(NE,Pcrd([XMAX,YMAX]));
  Strictmove("SW"); Strictmove("NE");
);
LLcrd(pt):=(
  regional(tmp);
  if(ispoint(pt),
    tmp=pt.xy
  ,
    tmp=pt;
  );
  tmp=[tmp_1/SCALEX,tmp_2/SCALEY];
  re(tmp); //191231
);
Putpoint(name,Pt):=Putpoint(name,Pt,Pt);
Putpoint(name,Ptinit,Pt):=(
  regional(ptstr); 
    ptstr=name+".xy="+Textformat(Pcrd(Pt),10)+";";
    parse(ptstr);
    Ptpos(name,Pcrd([Pt_1,Pt_2])); //200529
);
Textformat(value,dig):=(
  regional(vv,tmp,tmp1);
  if(islist(value),
    tmp1="[";
    forall(value,
      tmp1=tmp1+Textformat(#,dig)+",";
    );
    if(length(tmp1)>1, //18.01.29from
      tmp1=substring(tmp1,0,length(tmp1)-1);
    );
    tmp1=tmp1+"]"; //18.01.29until
  ,
    if(ispoint(value) % isstring(value),
      if(isstring(value),tmp1=Dq+value+Dq,tmp1=text(value)); // 15.10.02
    ,
      tmp1=format(value,dig);
    );
  );
  tmp1;
);
Ptpos(pt):=Ptpos(pt,[]);
Ptpos(ptorg,pos):=(
  regional(pt,out,tmp);
  if(ispoint(ptorg),pt=ptorg,pt=parse(ptorg));
  if(length(pos)==0,
    tmp=pt.name+"position";
    out=parse(tmp);
    if(!islist(out),
      tmp=tmp+"="+Textformat(pt.xy,12)+";";  //200108 6->12
      parse(tmp);
    );
  ,
    pt.xy=pos;
    tmp=pt.name+"position="+Textformat(pt.xy,12)+";"; //200108 6->12
    parse(tmp);
    out=pt.xy;
  );
  out;
);
Pcrd(pt):=(
  regional(tmp);
  if(ispoint(pt),
    tmp=pt.xy;
  ,
    tmp=[pt_1*SCALEX,pt_2*SCALEY];
  );
 re(tmp); //191231
);
Strictmove(pC):=Strictmove(pC,StrictSep); //190831
Strictmove(pCorg,sep):=(
  regional(pC,tmp,tmp1,tmp2);
  pC=pCorg;
  if(ispoint(pC),pC=pC.name);
  tmp1=pC+"position";
  if(!islist(parse(tmp1)),
    tmp=tmp1+"="+Textformat(parse(pC).xy,12)+";"; //200112
    parse(tmp);
  ,
   tmp=parse(pC).xy;
    tmp2=mouse().xy;
    if(|tmp-tmp2|>sep,
      tmp=pC+".xy="+pC+"position";
      parse(pC).xy=parse(pC+"position");
    ,
      tmp=tmp1+"="+Textformat(parse(pC).xy,12)+";"; //200112
      parse(tmp);
    );
  );
);
Addax(param):=(
  ADDAXES=text(param);
);
Addgraph(nm,pltdata):=Addgraph(nm,pltdata,[]);
Addgraph(nm,pltdata,options):=(
  regional(name,Ltype,Noflg,opcindy,pdata,fname,flg,
    tmp,tmp1,tmp2,tmp3,color,color4);
  if(substring(nm,0,1)=="-",
    name=substring(nm,1,length(nm));
  ,
    name="ad"+nm;
  );
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629
  opcindy=tmp_(length(tmp));
  if(isstring(pltdata), //201101from
    pdata=parse(pltdata);
  ,
    pdata=apply(pltdata,if(isstring(#),parse(#),#)); //201101to
  ); // 15.01.22
  pdata=Flattenlist(pdata);
  tmp1=[];
  forall(pdata,tmp2,
    tmp=Doscaling(tmp2); //201101
    tmp1=append(tmp1,tmp);
  );
  if(length(tmp1)==1,tmp1=tmp1_1);
  pdata=tmp1;
  if(Noflg<3,
    println("generate addgraph "+name);
    tmp=name+"="+Textformat(pdata,5)+";"; //190415
    parse(tmp);
    if(isstring(pltdata), // 16.04.04 from
      if(indexof(pltdata,"]")>0,
        tmp1="list"+PaO()+"Listplot"+PaO()+substring(pltdata,1,length(pltdata));
        tmp1=replace(tmp1,"]",",]");
      ,
        tmp1="Listplot("+substring(pltdata,0,length(pltdata))+",]";
      );
      flg=0;
      tmp2=[];
      tmp3=0;
      forall(1..(length(tmp1)),
        if(flg==0,
          tmp=indexof(substring(tmp1,tmp3,length(tmp1)),"_");
          if(tmp==0,
            flg=1;
          ,
            tmp3=tmp3+tmp;
            tmp=indexof(substring(tmp1,tmp3,length(tmp1)),",")-1;
            tmp=substring(tmp1,tmp3,tmp3+tmp);
            tmp2=append(tmp2,tmp);
          );
        );        
      );
      forall(tmp2,
        tmp1=replace(tmp1,"_"+#,"("+#+")");
      );
      tmp1=replace(tmp1,",]",")");
      tmp1=replace(tmp1,",","),Listplot(");
      if(indexof(pltdata,"[")>0,
        tmp1=tmp1+")";
      );
    ,
      if(Measuredepth(pdata)==1,
        tmp1=name+"=Listplot("+Textformat(pdata,5)+")";
      ,
        tmp1="list"+PaO();
        forall(1..(length(pdata)),
          tmp=name+"p"+Textformat(#,5)+"=";
          if(length(pdata_#)>1,  // 15.01.22
            tmp=tmp+"Listplot("+Textformat(pdata_#,5)+");"; //190425
          ,
            tmp=tmp+"Pointdata("+Textformat(pdata_#_1,5)+");"; //190425
          );
          tmp1=tmp1+name+"p"+Textformat(#,5)+",";
        );
        tmp1=name+"="+substring(tmp1,0,length(tmp1)-1)+");"; //190425
      );
    );
  );  // 16.04.04 until
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
);
Divoptions(options):=(
  regional(Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,
      color,opstr,opcindy,flg,tmp,tmp1,tmp2);
  Ltype="dr";  // 2015.01.13
  Noflg=0;
  Inflg=0;
  Outflg=0;
  eqL=[];
  realL=[];
  strL=[];
  color=Colorcmyk2rgb(KCOLOR); //200513
  opstr="";
  opcindy="";
  forall(options,
    flg=0;
    if(flg==0,
      if(isreal(#) % ispoint(#) % islist(#),
        realL=append(realL,#);
        opstr=opstr+","+text(#);
        flg=1;
      );
    );
    if(flg==0,
      if(indexof(#,"=")>0,
        tmp=Strsplit(#,"="); //180602from
        tmp1=Toupper(tmp_1);
        tmp2=tmp_2;
        if(tmp1=="COLOR",
          if(indexof(tmp2,"[")>0, //180928
            tmp1=parse(tmp2);
            color=tmp1;
            if(length(tmp1)==4,
              tmp1=Colorcmyk2rgb(tmp1);
            );
          ,
            color=Colorname2cmyk(tmp2);//200425
            tmp1=Colorcmyk2rgb(color); ;//200425
          );
          tmp="color->"+text(tmp1);
          opcindy=opcindy+","+tmp;
        ,
          eqL=append(eqL,#);
        );//180602to
        flg=1; 
      );
    );
    if(flg==0,
      if(indexof(#,"no")+indexof(#,"No")>0,
        if(indexof(#,"tex")>0,Noflg=1);
        if(indexof(#,"disp")>0,Noflg=2);
        if(indexof(#,"data")>0,Noflg=3);
        flg=1;
      );
    );
    if(flg==0,
      if(indexof(#,"->")>0,
        opcindy=opcindy+","+#;
        flg=1; 
      );
    );
    if(flg==0,
      if(indexof(#,"out")+indexof(#,"Out")>0,
        if(indexof(#,"-")==0,
          Outflg=1;
        ,
          Outflg=2;
        );
        flg=1;
      );
    );
    if(flg==0,
      if(indexof(#,"in")+indexof(#,"In")>0,
        if(indexof(#,"-")==0,
          Inflg=1;
        ,
          Inflg=2;
        );
        flg=1;
      );
    );
    if(flg==0,
      tmp=substring(#,0,2);
      tmp1=indexof(tmp,"dr")+indexof(tmp,"Dr");
      tmp1=tmp1+indexof(tmp,"da")+indexof(tmp,"Da");
      tmp1=tmp1+indexof(tmp,"id")+indexof(tmp,"Id");
      tmp1=tmp1+indexof(tmp,"do")+indexof(tmp,"Do");
      tmp1=tmp1+indexof(tmp,"dp")+indexof(tmp,"Dp");
      if(tmp1>0,
        Ltype=#;
        flg=1;
      );
      if(flg==0,
        if(length(#)>0, //180408
          strL=append(strL,#);
          opstr=opstr+","+Dq+#+Dq;
        );
      );
    );
  );
  if(indexof(opcindy,"color->")==0,// 16.10.07from
    tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]
    opcindy=opcindy+",color->"+text(tmp);
  );
  [Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,color,opstr,opcindy];
);
Colorname2cmyk(name):=( //181212
  regional(dL,code,tmp);
  dL=[
    ["greenyellow",[0.15,0,0.69,0]],["yellow",[0,0,1,0]],
    ["goldenrod",[0,0.1,0.84,0]],["dandelion",[0,0.29,0.84,0]],
    ["apricot",[0,0.32,0.52,0]],["peach",[0,0.5,0.7,0]],
    ["melon",[0,0.46,0.5,0]],["yelloworange",[0,0.42,1,0]],
    ["orange",[0,0.61,0.87,0]],["burntorange",[0,0.51,1,0]],
    ["bittersweet",[0,0.75,1,0.24]],["redorange",[0,0.77,0.87,0]],
    ["mahogany",[0,0.85,0.87,0.35]],["maroon",[0,0.87,0.68,0.32]],
    ["brickred",[0,0.89,0.94,0.28]],["red",[0,1,1,0]],
    ["orangered",[0,1,0.5,0]],["rubinered",[0,1,0.13,0]],
    ["wildstrawberry",[0,0.96,0.39,0]],["salmon",[0,0.53,0.38,0]],
    ["carnationpink",[0,0.63,0,0]],["magenta",[0,1,0,0]],
    ["violetred",[0,0.81,0,0]],["rhodamine",[0,0.82,0,0]],
    ["mulberry",[0.34,0.9,0,0.02]],["redviolet",[0.07,0.9,0,0.34]],
    ["fuchsia",[0.47,0.91,0,0.08]],["lavender",[0,0.48,0,0]],
    ["thistle",[0.12,0.59,0,0]],["orchid",[0.32,0.64,0,0]],
    ["darkorchid",[0.4,0.8,0.2,0]],["purple",[0.45,0.86,0,0]],
    ["plum",[0.5,1,0,0]],["violet",[0.79,0.88,0,0]],
    ["royalpurple",[0.75,0.9,0,0]],["blueviolet",[0.86,0.91,0,0.04]],
    ["periwinkle",[0.57,0.55,0,0]], ["cadetblue",[0.62,0.57,0.23,0]],
    ["cornflowerblue",[0.65,0.13,0,0]],
    ["midnightblue",[0.98,0.13,0,0.43]],
    ["navyblue",[0.94,0.54,0,0]],["royalblue",[1,0.5,0,0]],
    ["blue",[1,1,0,0]],["cerulean",[0.94,0.11,0,0]],
    ["cyan",[1,0,0,0]],["processblue",[0.96,0,0,0]],
    ["skyblue",[0.62,0,0.12,0]],["turquoise",[0.85,0,0.2,0]],
    ["tealblue",[0.86,0,0.34,0.02]],["aquamarine",[0.82,0,0.3,0]],
    ["bluegreen",[0.85,0,0.33,0]],["emerald",[1,0,0.5,0]],
    ["junglegreen",[0.99,0,0.52,0]],["seagreen",[0.69,0,0.5,0]],
    ["green",[1,0,1,0]],["forestgreen",[0.91,0,0.88,0.12]],
    ["pinegreen",[0.92,0,0.59,0.25]],["limegreen",[0.5,0,1,0]],
    ["yellowgreen",[0.44,0,0.74,0]],["springgreen",[0.26,0,0.76,0]],
    ["olivegreen",[0.64,0,0.95,0.4]],["rawsienna",[0,0.72,1,0.45]],
    ["sepia",[0,0.83,1,0.7]],["brown",[0,0.81,1,0.6]],
    ["tan",[0.14,0.42,0.56,0]],["gray",[0,0,0,0.5]],
    ["lightgray",[0,0,0,0.15]], //190429,0809
    ["cindycolor",[0.125,0.083,0,0.247]], //201027
    ["black",[0,0,0,1]],["white",[0,0,0,0]],
    ["offwhite",[0,0,0,0.03]] //190809
  ];
  tmp=select(dL,#_1==name);
  if(length(tmp)>0,
    tmp=tmp_1;
    code=tmp_2;
  ,
    println("    "+name+" not found");
    code=Assign(name); //190323
  );
);
Assign(str):=( //190125from
  regional(tmp);
  tmp=[];
  forall(VLIST,tmp=concat(tmp,[#_1,#_2]));
  Assign(str,tmp);
); //190125to
Assign(funstr,vrL):=Assign(funstr,vrL,6);
Assign(funstr,Arg1,Arg2):=( //190813from
  regional(vrL,precise,nn,out,tmp);
  if(islist(Arg1),
    vrL=Arg1; precise=Arg2;
    nn=length(vrL)/2;
    out=funstr;
    forall(1..nn,
      out=Assign(out,vrL_(2*#-1),vrL_(2*#),precise);
    );
  , 
    out=Assign(funstr,Arg1,Arg2,6);
  );
  out;
); //190813to
Assign(funstr,varname,rep,precision):=(
  regional(repstr,ii,jj,tmp,tmp1,tmp2,Notvar,Flg);
  if(isstring(rep),repstr=rep,repstr="("+Textformat(rep,precise)+")"); //190811to
  tmp=[46];  // 12.20
  tmp=concat(tmp,48..57);
  tmp=concat(tmp,65..90);
  tmp=concat(tmp,97..122);
  Notvar=apply(tmp,unicode(text(#),base->10));
  tmp2="";
  forall(1..100,
    ii=indexof(funstr,varname);
    if(ii>0,
      Flg=0;
      if(ii>1,
        tmp=substring(funstr,ii-2,ii-1);
        if(contains(Notvar,tmp),
          tmp2=tmp2+substring(funstr,0,ii);
          funstr=substring(funstr,ii,length(funstr));
          Flg=1;
        );
      );
      if(Flg==0,
        jj=ii-1+length(varname);
        if(jj<length(funstr),
          tmp=substring(funstr,jj,jj+1));
          if(contains(Notvar,tmp),
          tmp2=tmp2+substring(funstr,0,jj);
          funstr=substring(funstr,jj,length(funstr));
          Flg=1;
        );
      );
      if(Flg==0,
        tmp2=tmp2+substring(funstr,0,ii-1)+repstr;
        funstr=substring(funstr,jj,length(funstr));
      );
    );
  );
  funstr=tmp2+funstr;
  funstr;
);
Colorcmyk2rgb(clr):=(
  regional(clrnew,tmp,black);
  if(length(clr)==4,  //200618
    black=clr_4;
    tmp=apply(clr,1-min(1,#*(1-black)+black));
    clrnew=tmp_(1..3);
  ,
    clrnew=clr;  //200618
  );
  clrnew;
);
Colorrgb2cmyk(clr):=(
  regional(clrnew,tmp,black);
  if(length(clr)==3, //200618
    tmp=apply(clr,1-#);
    black=min(tmp);
    if(black!=1, //181112from
      tmp=apply(clr,(1-#-black)/(1-black));
      clrnew=append(tmp,black);
    ,
      clrnew=[0,0,0,1];  //200618
    ); //181112to
  ,
    clrnew=clr;
  );
  clrnew;
);
Flattenlist(pltlist):=(
  regional(Out,nn,Dt,ii,tmp,flg);
  Out=[];
  if(Measuredepth(pltlist)==1,
    Out=[pltlist];
  ,
    forall(1..(length(pltlist)),nn,
      Dt=pltlist_nn;
      if(Measuredepth(Dt)<2,
        Out=append(Out,Dt);
      ,
        forall(1..(length(Dt)),ii,
          tmp=Flattenlist(Dt_ii);
          Out=concat(Out,tmp);
        );
      );
    );
  );
  Out;
);
Measuredepth(list):=( //190423
  regional(str,nn,tmp,tmp1,tmp2);
  str=text(list);
  tmp1=Indexall(str,"[");
  tmp2=select(tmp1,!contains(tmp1,#+1));
  nn=tmp2_1;
  tmp1=substring(str,nn,length(str));
  tmp=indexof(tmp1,",");
  tmp1=substring(tmp1,0,tmp-1);
  if(!ispoint(parse(tmp1)),
    nn=nn-1;
  );
  nn;
);
Doscaling(pdata):=(
  regional(Level,Out);
  Out=[];
  if(!islist(pdata_1),
    Out=[pdata_1*SCALEX,pdata_2*SCALEY];
  ,
    forall(pdata,
      Out=append(Out,Doscaling(#))
    );
  );
  Out;
);
PaO():=PaO("");
PaO(Arg):=(
  regional(out);
  if(isstring(Arg),
    out="("+Arg;
  ,
    out="";
    repeat(Arg,
      out=out+"(";
    );
  );
  out;
);
Getlinestyle(str,name):=(
  regional(noflg,tmp,tmp1,tmp2,Dop,Ltype,subflg);
  Ltype=-1;
  Dop="";
  tmp1=indexof(str,",");
  if(tmp1>0,
    Dop=","+substring(str,tmp1,length(str));
  );
  noflg=parse(substring(str,0,1));
  if(substring(name,0,3)=="sub",subflg=1,subflg=0);  // 16.02.29
  if(noflg<=1, //1900818from
    tmp1=Toupper(substring(str,1,3));
  ,
    tmp1="NO";
  ); //1900818to
  tmp2=""; //190119from
  tmp=indexof(str,",");
  if(tmp>0,
    tmp2=substring(str,tmp,length(str));
  ); //190119to
  if(tmp1=="DR",
    if(length(tmp2)==0,tmp2="1"); //190125
    Ltype=[0,tmp2];  //190119
    if(noflg==0 & subflg==0, // 16.02.29
    );
  );
  if(tmp1=="DA",
    if(length(tmp2)==0,tmp2="1,1"); //190125
    if(indexof(tmp2,",")==0,tmp2=tmp2+",1"); //200911
    Ltype=[1,tmp2];  //190119
    if(noflg==0 & subflg==0, // 16.02.29
    );
  );
  if(tmp1=="ID",
    if(length(tmp2)==0,tmp2="1,1"); //190125
    if(indexof(tmp2,",")==0,tmp2=tmp2+",1"); //200911
    Ltype=[2,tmp2];  //190119
    if(noflg==0 & subflg==0, // 16.02.29
    );
  );
  if(tmp1=="DO",
    if(length(tmp2)==0,tmp2="1,1"); //190125
    if(indexof(tmp2,",")==0,tmp2=tmp2+",1"); //200911
    Ltype=[3,tmp2];  //190119
    if(noflg==0 & subflg==0, // 16.02.29
    );
  );
  if(tmp1=="DP",
    if(length(tmp2)==0,tmp2="1"); //190125
    Ltype=[0,tmp2];  //190119
    tmp1=parse(name);
    tmp2="";
    forall(tmp1,
      tmp2=tmp2+Textformat(#_1,5)+",";
    );
    tmp2=substring(tmp2,0,length(tmp2)-1);
    if(noflg==0,
    );
  );
  if(tmp1=="NO", //190818from
    Ltype=[-1,"0"];
  );  //190818to
  Ltype;
);
Textedit(no):=(
  regional(tmp,tmp1,tmp2);
  tmp="Text"+text(no)+".currenttext";
  tmp1=parse(tmp);
  tmp1;
);
Textedit(n0,str):=Textedit(n0,str,"="); //210406from
Textedit(n0,str,sep):=( //210208from
  regional(tmp,tmp1,tmp2,out);
  tmp1=str;
tmp1=Textedit(n0); //
  tmp2=tmp1;
  if(length(sep)>0,
    tmp=Strsplit(sep+tmp1,sep);
    tmp2=tmp_(-1);
  ); //210406to
  if(length(tmp2)==0,out=str,out=tmp2);
  out;
); //210208to
Subsedit(no,str):=(
 regional(tmp,tmp1);
 if(isstring(str),
   tmp1=str;
 ,
   tmp1=text(str);
 );
 tmp="Text"+text(no); //210211[2lines]
 parse(tmp).currenttext=tmp1;
);
Addasterisk(strorg):=(
  regional(pL,sL,funL,fn,sgnL,numL,alphaL,
      str0,str,f,k,n1,n2,sub,res,tmp,tmp1,tmp2,ctr,out,s,flg,repL);
  str0=replace(strorg,"  ","*");
  funL=["sin","cos","tan","log"]; 
  sgnL=["+","-"];
  forall(funL,f,
    str="";
    res=str0;
    ctr=1;
    while((indexof(res,f)>0)&(ctr<100),
      tmp1=indexof(res,f);
      str=str+substring(res,0,tmp1+2);
      res=substring(res,tmp1+2,length(res));
      if(res_1==" ",
        str=str+"(";
        res=substring(res,1,length(res));
        tmp=indexof(res," ");
        if(tmp>0,
          str=str+substring(res,0,tmp-1)+")";
          res=substring(res,tmp,length(res));
        ,
          str=str+res+")";
          res="";
        );
      );
      if(res_1=="(",
        tmp1=bracket(res,"()");
        tmp1=select(tmp1,#_2==-1);
        if(length(tmp1)>0,tmp1=tmp1_1_1,tmp1=0);
        flg=0;
        forall(sgnL,s,
          if(flg==0,
            tmp2=Getlevel(substring(res,0,tmp1),s); //210405
            if(length(tmp2)>0,
              tmp2=select(tmp2,#_2==1);
              if(length(tmp2)>0,tmp2=tmp2_1_1,tmp2=0);
              if(tmp2<tmp1, //210302
                res=substring(res,1,tmp1-1)+"))"+substring(res,tmp1,length(res));
                str=str+"((";
                flg=1;
              );
            );
          );
        );
      );
      ctr=ctr+1;
    );
    str0=str+res;
  );
  str=str0;
  repL=[];  //210405from
  ctr=1;
  tmp=indexof(str,"\");
  while((tmp>0)&(ctr<50),
    res=substring(str,tmp-1,length(str));
    str=substring(str,0,tmp-1);
    tmp=indexof(res," ");
    tmp1=substring(res,0,tmp);
    res=substring(res,tmp,length(res));
    repL=append(repL,tmp1);
    tmp="#"+text(length(repL))+"#";
    str=str+tmp+res;
    tmp=indexof(str,"\");
    ctr=ctr+1;
  );  //210405to
  str=replace(str," ","*");
  str=replace(str,"pi","%");
  str=replace(str,"ex(","exp("); //210227from
  tmp=Indexall(str,"e");
  if(length(tmp)>0,
    tmp1=substring(str,0,tmp_1-1);
    forall(tmp,
      if(!substring(str,#,#+3)!="xp(",
        tmp1=tmp1+"exp(1)";
      ,
        tmp1=tmp1+"e";
      );
    );
    str=tmp1+substring(str,tmp_(-1),length(str));;
  );

  funL=["sin","cos","tan","log","fr","sq","exp"]; //210227to
  sgnL=["+","-","*","/","^"];
  numL=append(apply(0..9,text(#)),"."); //210226
  tmp1=32..126;
  tmp=(65..90)++(97..122);
  tmp1=remove(tmp1,tmp);
  alphaL=apply(tmp,unicode(text(#),base->10));
  alphaL=concat(alphaL,["%"]);
  str="$"+str;
  pL=Bracket(str);
  pL=concat(pL,[[length(str),0]]);
  pL=concat([[1,0]],pL);
  out=[];
  forall(1..(length(pL)-1),k,
    tmp=pL_k; n1=tmp_1; l1=tmp_2;
    tmp=pL_(k+1); n2=tmp_1; l2=tmp_2;
    sub=substring(str,n1-1,n2);
    out=append(out,sub);
  );
  forall(1..(length(pL)-1),k,
    sub=out_k;
    if(length(sub)>0,
      res=sub_(-1);
      sub=substring(sub,0,length(sub)-1);
    ,
      res=""
    );
    forall(funL,f,
      tmp=indexof(sub,f);
      if(tmp>0,
        res=substring(f,0,length(f))+"(";
        sub=substring(sub,0,tmp-1);
      );
    );
    ctr=1;
    while((length(sub)>0)&(ctr<200),
      tmp1=sub_(-1);
      tmp2=res_1;
      sub=substring(sub,0,length(sub)-1);
      if(contains(alphaL,tmp2),
        tmp=concat(alphaL,numL);
        tmp=concat(tmp,[")"]);
        if(contains(tmp,tmp1),
          res="*"+res;
        );
      );
      if(contains(numL,tmp2),
        tmp=concat(aphaL,[")"]);
        if(contains(tmp,tmp1),
          res="*"+res;
        );
      );
      res=tmp1+res;
      ctr=ctr+1;
    );
    out_k=substring(res,1,length(res));
  );
  res="";
  forall(out,
    res=res+#;
  );
  out=replace(res,"%","pi");
  out=replace(out,"$","");
  forall(1..(length(repL)),n1,  //210405from
    out=replace(out,"#"+text(n1)+"#",repL_n1);
  ); //210405to
  out;
);
Getlevel(str):=Getlevel(str,",");
Getlevel(str,Arg):=Getlevel(str,Arg,"()");
Getlevel(str,Arg,bra):=(
  regional(nL,parL,n,tmp,tmp1,tmp2,out);
  if(islist(Arg),
    nL=Arg;
  ,
    nL=Indexall(str,Arg);
  );
  parL=Bracket(str,bra);
  if(length(parL)==0,parL=[[0,0]]);
  out=[];
  forall(nL,n,
    tmp2=select(parL,#_1<n);
    tmp2=tmp2_(-1);
    if(tmp2_2>=0,tmp=tmp2_2,tmp=-tmp2_2-1);
    out=append(out,[n,tmp]);
  );
  out;
);
Bracket(str):=Bracket(str,"()");
Bracket(str,br):=(
  regional(ph,pt,out,noL,ncL,nall,level,tmp);
  ph=substring(br,0,1);
  pt=substring(br,1,2);
  noL=Indexall(str,ph);
  ncL=Indexall(str,pt); // 16.05.22until
  nall=sort(concat(noL,ncL));
  level=0;
  out=[];
  forall(nall,
    if(contains(noL,#),
      level=level+1;
      tmp=[#,level];
    ,
      tmp=[#,-level];
      level=level-1;
    );
    out=append(out,tmp);
  );
  out;
);
Tocindyform(str):=( //190521
  regional(funL,out,plv,flg,nn,tmp,tmp1);
  out=str;
  funL=["cos","sin","tan"]; //210302from
  forall(funL,
    out=replace(out,#+"((-1,","arc"+#+"((");
    out=replace(out,#+"(-1,","arc"+#+"(");
  ); //210302to
  out=replace(out,"\",""); //190712[4lines]
  out=replace(out,"   "," ");
  out=replace(out,"  "," "); 
  out=replace(out," ","*"); 
  plv=Bracket(out,"()");
  flg=0;
  if(length(plv)==0,
    flg=4; //190522
  );
  if(flg==0,
    tmp=Indexall(out,"("); //190522from
    tmp1=Indexall(out,")");
    if(length(tmp)>length(tmp1),
      flg=2;
      out=out+"?+)?";
    );
    if(length(tmp)<length(tmp1),
      flg=3;
      out=out+"?)-?";
    );  //190522to
    forall(1..20,
      if(flg==0,
        tmp=Tocindyformpart(out);
        if(length(tmp)==0,
          flg=1;
        ,
          out=tmp;
        );
      );
    );
  );
  out=replace(out,"{","(");
  out=replace(out,"}",")");
  out;
);
Tocindyformpart(str):=( //190521
  regional(plv,funL,repL,flg,flgf,nall,nn,fun,funf,
      frL,fr,out,tmp,tmp1,tmp2,tmp3,tmp4);
  repL=[ //190515from
    ["frac",["","{xx}/{yy}"]],
    ["log",["log{xx}","log{yy}/log{xx}"]],
    ["sqrt",["sqrt{xx}","{yy}^(1/{xx})"]], //190522
    ["pow",["","{xx}^{yy}"]],
    ["sin",["sin{xx}","{sin{yy}}^{xx}"]], //190522from
    ["cos",["cos{xx}","{cos{yy}}^{xx}"]],
    ["tan",["tan{xx}","{tan{yy}}^{xx}"]] //190522to
  ];
  funL=apply(repL,substring(#_1,0,2)); //190515to
  out="";
  plv=Bracket(str,"()");
  nall=length(plv);
  if(nall>0,
    frL=[];
    forall(1..nall,nn,
      tmp1=plv_nn;
      if(tmp1_2>0,
        fun="";
        flgf=0;
        forall(1..20,
          if(flgf==0,
            tmp2=tmp1_1;
            tmp=substring(str,tmp2-#-1,tmp2-#);
            if((tmp>="a")&(tmp<="z"),
              fun=tmp+fun;
            ,
              flgf=1;
            );       
          );
        );
        tmp=substring(fun,0,2); //190515from
        if(contains(funL,tmp), 
          tmp=select(repL,substring(#_1,0,2)==tmp);
          funf=tmp_1_1; //190515to
          tmp=select(plv,(#_1>tmp1_1)&(#_2==-tmp1_2));
          tmp=tmp_1_1-1;
          frL=append(frL,[fun,funf,tmp1_1,tmp,tmp1_2]);
        );
      );
    );
    if(length(frL)>0,
      frL=sort(frL,[-#_5]);
      fr=frL_1;
      fun=fr_1; funf=fr_2;
      tmp1=substring(str,fr_3,fr_4);
      tmp=select(repL,#_1==funf);
      tmp=tmp_1;
      tmp2=tmp_2;
      tmp=Strsplit(tmp1,","); //190515from
      nn=length(tmp); 
      if(nn==1,
        tmp2=Assign(tmp2_1,["xx",tmp_1]);
      );
      if(nn==2,
        tmp2=Assign(tmp2_2,["xx",tmp_1,"yy",tmp_2]);
      ); //190515to
      nn=fr_3-length(fun);
      tmp=substring(str,0,nn-1);
      out=tmp+tmp2+substring(str,fr_4+1,length(str));
    ,
      out="";
    );
  );
  out;
);
Totexform(str):=( //190514
  regional(funL,f,out,plv,flg,nn,tmp,tmp1,tmp2);
  out=replace(str,"pi","\pi"); //190715
  out=replace(out,"exp(1)","e"); //210227
  funL=["cos","sin","tan"]; //210303from
  forall(funL,f,
    tmp2="";
    tmp1=indexof(out,f+"((-1,");
    flg=1;
    while((tmp1>0)&(flg<100),
      if(tmp1>1,tmp=substring(out,0,tmp1-1),tmp="");
      tmp2=tmp2+tmp+"\"+f+"^(-1)"; // 210303[2lines]
      out="("+substring(out,tmp1+length(f+"((-1,")-1,length(out));
      tmp=Bracket(out,"()");
      tmp=select(tmp,#_2==-1);
      tmp=tmp_1_1;
      tmp2=tmp2+substring(out,0,tmp);
      out=substring(out,tmp+1,length(out));
      tmp1=indexof(out,f+"((-1,");
      flg=flg+1;
    );
    if(length(tmp2)>0,out=tmp2+out);
  ); //210303to
  out=replace(out,f+"(-1,",f+"^(-1)(");
  tmp1=apply(0..9,text(#));  //190915from
  tmp2=Indexall(out,"*");
  forall(tmp2,
    tmp=substring(out,#,#+1);
    if(contains(tmp1,tmp),
      out=substring(out,0,#-1)+"$"+substring(out,#,length(out));
    ,
      out=substring(out,0,#-1)+"%"+substring(out,#,length(out));
    );
  );
  out=replace(out,"$","\cdot ");
  out=replace(out,"%"," "); //190915to,201018
  out=replace(out,"  ","\;");
  plv=Bracket(out,"()"); //190515from
  flg=0; //190521from
  if(length(plv)==0,
    flg=4; //190522
  );
  if(flg==0, //190521to
    tmp=Indexall(out,"("); //190522from
    tmp1=Indexall(out,")");
    if(length(tmp)>length(tmp1),
      flg=2;
      out=out+"?+)?";
    );
    if(length(tmp)<length(tmp1),
      flg=3;
      out=out+"?)-?";
    );  //190522to
    forall(1..20,
      if(flg==0,
        tmp=Totexformpart(out);
        if(length(tmp)==0,
          flg=1;
        ,
          out=tmp;
        );
      );
    );
  );
  if(flg<=1,
    out=replace(out,"+-","\pm ");
    out=replace(out,"-+","\mp ");
    out=replace(out,"<=","\leq ");
    out=replace(out,">=","\geq ");
    tmp1=Indexall(out,"^");
    forall(tmp1,nn,
      if(substring(out,nn,nn+1)=="(",
        tmp2=Bracket(substring(out,nn,length(out)),"()");
        tmp2=select(tmp2,#_2==-1);
        tmp2=tmp2_1_1+nn;
        tmp=substring(out,nn+1,tmp2-1);
        tmp2=substring(out,tmp2,length(out));//190915
        out=substring(out,0,nn)+"{"+tmp+"}";
        out=out+tmp2;
      );
    );
  );
  out;
);
Totexformpart(str):=( //190515from
  regional(plv,funL,repL,flg,flgf,nall,nn,fun,funf,
      frL,fr,out,tmp,tmp1,tmp2,tmp3,tmp4);
  repL=[ //190515from
    ["frac",["","\frac{xx}{yy}"]], //210228from
    ["log",["\log xx ","\log_{xx} yy"]], //210405
    ["sqrt",["\sqrt{xx}","\sqrt[xx]{yy}"]],
    ["pow",["","{xx}^{yy}"]],
    ["sin",["\sin xx ","\sin^{xx}\! yy "]], //200823[3lines]  //210405
    ["cos",["\cos xx ","\cos^{xx}\! yy "]], //210405
    ["tan",["\tan xx ","\tan^{xx}\! yy "]]  //210228to  //210405
  ];
  funL=apply(repL,substring(#_1,0,2)); //190515to
  out="";
  plv=Bracket(str,"()");
  nall=length(plv);
  if(nall>0,
    frL=[];
    forall(1..nall,nn,
      tmp1=plv_nn;
      if(tmp1_2>0,
        fun="";
        flgf=0;
        forall(1..20,
          if(flgf==0,
            tmp2=tmp1_1;
            tmp=substring(str,tmp2-#-1,tmp2-#);
            if((tmp>="a")&(tmp<="z"),
              fun=tmp+fun;
            ,
              flgf=1;
            );       
          );
        );
        tmp=substring(fun,0,2); //190515from
        if(contains(funL,tmp), 
          tmp=select(repL,substring(#_1,0,2)==tmp);
          funf=tmp_1_1; //190515to
          tmp=select(plv,(#_1>tmp1_1)&(#_2==-tmp1_2));
          tmp=tmp_1_1-1;
          frL=append(frL,[fun,funf,tmp1_1,tmp,tmp1_2]);
        );
      );
    );
    if(length(frL)>0,
      frL=sort(frL,[-#_5]);
      fr=frL_1;
      fun=fr_1; funf=fr_2;
      tmp1=substring(str,fr_3,fr_4);
      tmp=select(repL,#_1==funf);
      tmp=tmp_1;
      tmp2=tmp_2;
      tmp=Strsplit(tmp1,","); //190515from
      nn=length(tmp); 
      if(nn==1,
        tmp2=Assign(tmp2_1,["xx",tmp_1]);
      );
      if(nn==2,
        tmp2=Assign(tmp2_2,["xx",tmp_1,"yy",tmp_2]);
      ); //190515to
      nn=fr_3-length(fun);
      tmp=substring(str,0,nn-1);
      out=tmp+tmp2+substring(str,fr_4+1,length(str));
    ,
      out="";
    );
  );
  out;
);
Plotdata(name1,func,variable):=Plotdata(name1,func,variable,[]);
Plotdata(name1,func,variable,options):=(
  regional(Fn,Va,tmp,tmp1,tmp2,eqL,name,Vname,x1,x2,dx,
         PdL,Num,Ec,Dc,Fun,Exfun,x,Ke,Eps,Pa,Msg,
         Ltype,Noflg,Inflg,Outflg,opstr,opcindy,color,color4);
  if(substring(name1,0,1)!="-",  //190420from
    name="gr"+name1;
  ,
    name=substring(name1,1,length(name1));
  ); //190420to
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  Inflg=tmp_3;
  Outflg=tmp_4;
  opstr=tmp_(length(tmp)-1);
  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200629
  opcindy=tmp_(length(tmp));
  eqL=tmp_5;
  Num=50;
  Ec=[];
  Exfun="";
  Dc=1000;
  Msg="Y";
 Msg="N"; //
  forall(eqL,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(substring(#,0,1));
    if(tmp1=="N",
      Num=parse(tmp_2);
      opstr=opstr+","+Dqq(#);
    );
    if(tmp1=="E",
      if(substring(tmp_2,0,1)=="[", //180817from
        Ec=parse(tmp_2);
        tmp1=replace(tmp_2,"[","c"+PaO());
        tmp1=replace(tmp1,",",".0,");
        tmp1=replace(tmp1,"]",".0)");
        opstr=opstr+","+Dqq("Exc="+tmp1); //180817to
      ,
        Exfun=tmp_2; //200716
        opstr=opstr+","+Dqq(#);
      );
    );
    if(substring(#,0,1)=="D",
      Dc=parse(tmp_2);
      opstr=opstr+","+Dqq(#);
    );
    if(tmp1=="M", //190206from
      Msg=Toupper(substring(tmp_2,0,1));
    ); //190206to
  );
  if(Inflg==0 & Outflg==0,
    Eps=10^(-3);
    tmp=replace(func,LFmark,"");
    tmp=tokenize(variable,"=");
    Vname=tmp_1;
    if(length(tmp)>1,
      tmp=tmp_2;
      tmp=parse(tmp);
      x1=tmp_1;
      x2=tmp_2;
      ,
      x1=XMIN;
      x2=XMAX;
    );
    Ec=append(sort(Ec),10000);
    Fun=Assign(func,Vname, "xx");
    Exfun=Assign(Exfun,Vname, "xx");
    PdL=[];
    Ke=1;
    forall(0..Num, 
      xx=x1+#*(x2-x1)/Num; // differs from Scilab [ / Num-1]
      if(length(Exfun)>0,
        tmp=parse(Exfun);
        if(abs(tmp)<Eps,
          if(length(PdL)>0, //180817from
            PdL=concat(PdL,["inf"]);
          );
        ,
          tmp=[xx,parse(Fun)];
          if(length(PdL)>0,
            tmp1=PdL_(length(PdL));
            if(Norm(tmp,tmp1)<Dc,
              PdL=append(PdL,tmp);
            ,
              if(tmp1=="inf",
                PdL=append(PdL,tmp);
              ,
                PdL=concat(PdL,[["inf"],tmp]);
              );
          );
          ,
            PdL=[tmp];
          );
        ); //180817to
      ,
        Pa=[];
        if(xx-Ec_Ke<-Eps,
          Pa=[xx,parse(Fun)];
        );
        if(abs(xx-Ec_Ke)<=Eps,
          if(length(PdL)>0,
            if(PdL_(length(PdL))_1!="inf",
              Pa=["inf"];
            );
          );
        );
        if(xx-Ec_Ke>Eps,
          Pa=[xx,parse(Fun)];
          Ke=Ke+1;
        );
        if(length(Pa)>0,
          if(Pa_1=="inf",
            PdL=concat(PdL,[Pa]);
          ,
            if(length(PdL)==0,
              PdL=[Pa];
            ,
              tmp=PdL_(length(PdL));
              if(tmp_1=="inf",
                PdL=concat(PdL,[Pa]);
              ,
                if(dist(tmp,Pa)<Dc,
                  PdL=concat(PdL,[Pa]);
                ,
                  PdL=concat(PdL,[["inf"],Pa]);
                );
              );
            );
          );
        );
      );
    );
    tmp1=[];
    tmp2=select(1..(length(PdL)),PdL_#==["inf"]);
    tmp=1;
    forall(tmp2,
      if(#>tmp,
        tmp1=concat(tmp1,[PdL_(tmp..(#-1))])
      );
      tmp=#+1;
    );
    if(tmp<length(PdL),
      tmp1=concat(tmp1,[PdL_(tmp..(length(PdL)))]);
    );
    PdL=tmp1;
    if(length(PdL)==1,
      PdL=PdL_1;
    );
    if(Noflg<3,
      if(Msg=="Y", //190206
        println("generate Plotdata "+name);
      );
      if(Measuredepth(PdL)==1,
        tmp1=apply(PdL,Pcrd(#));
      ,
        tmp1=[];
        forall(PdL,tmp2,
          tmp1=append(tmp1,apply(tmp2,Pcrd(#)));
        );
      );
      tmp=name+"="+Textformat(tmp1,5)+";";
      parse(tmp);
    );
    if(Noflg<3, //190818
      if(isstring(Ltype),
        Ltype=Getlinestyle(text(Noflg)+Ltype,name);
     ,
        if(Noflg==1,Ltype=0);
      );
      GCLIST=append(GCLIST,[name,Ltype,opcindy]);
    );
    PdL;
  , 
    if(Noflg<3, //190818
      if(isstring(Ltype),
        Ltype=Getlinestyle(text(Noflg)+Ltype,name);
      ,
        if(Noflg==1,Ltype=0);
      );
      if(Inflg==1,
        GCLIST=append(GCLIST,[name,Ltype,opcindy]);
      );
    );
  );
);
Dqq(str):=DqDq(str); //18.02.11
DqDq(str):=(
  unicode("0022")+str+unicode("0022");
);
Norm(v1):=(  // 16.09.01
  regional(out,tmp,tmp1,tmp2);
  out=0;
  forall(1..(length(v1)),
    out=out+(v1_#)^2;
  );
  out=sqrt(out);
  out;
);
Norm(v1,v2):=(
  Norm(v2-v1);
);
Framedata2(nm,list):=Framedata2(nm,list,[]);
Framedata2(nm,list,options):=(
  regional(tmp,tmp1,pC,pB);
  pC=(Lcrd(list_1)+Lcrd(list_2))/2;
  pB=Lcrd(list_2);
  Framedata(nm,[pC,pB],options);
);
Lcrd(pt):=(
  regional(tmp);
  if(ispoint(pt),
    tmp=[pt.x/SCALEX,pt.y/SCALEY];
  ,
    tmp=pt;
  );
  re(tmp); //191231
);
Framedata():=Framedata(["dr"]);//16.10.29from
Framedata(list):=(
  regional(pA,pB);
  if(Measuredepth(list)==0,
    pA=LLcrd((SW+NE)/2); // 15.09.17
    pB=LLcrd(NE);
    Framedata("win",[pA,pB],list);
  ,
    Framedata(list,[]);
  );
);//16.10.29until
Framedata(Arg1,Arg2):=(
  regional(name,list,options,str);
  if(isstring(Arg1),
    name=Arg1;
    list=Arg2;
    Framedata(name,list,[]);
  ,
    list=Arg1;
    options=Arg2;
    name="";// 16.10.07from
    forall(list, 
       name=name+#.name;
    );// 16.10.07until
    Framedata(name,list,options);
  );
);
Framedata(nm,list,optionsorg):=( //190424modified
  regional(name,options,Out,tmp,tmp1,x1,x2,y1,y2,dx,dy,
      Ltype,Noflg,strL,cent,dx,dy,color,strL,corner);
  name="fr"+nm;
  options=optionsorg;
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  strL=tmp_7; //191126
  color=tmp_(length(tmp)-2);
  corner=0; //191126from
  forall(strL,
    tmp=substring(Toupper(#),0,1);
    if(tmp=="C",
      tmp=Lcrd(list_1); tmp1=Lcrd(list_2); //191227
      cent=(tmp+tmp1)/2;
      dx=abs(tmp1_1-tmp_1)/2;
      dy=abs(tmp1_2-tmp_2)/2;
      corner=1;
      options=remove(options,[#]);
    );
  );
  if(corner==0,
    if(length(list)==2,  // 15.05.12
      cent=Lcrd(list_1); tmp=Lcrd(list_2);
      dx=abs(tmp_1-cent_1); dy=abs(tmp_2-cent_2);
    ,
      cent=Lcrd(list_1);
      dx=list_2; dy=list_3;
    );
  );  //191126to
  x1=cent_1-dx; x2=cent_1+dx;
  y1=cent_2-dy; y2=cent_2+dy;
  Listplot("-"+name,[[x1,y1],[x2,y1],[x2,y2],[x1,y2],[x1,y1]],options);
);
Framedata(nm,cent,dx,dy):=Framedata(nm,[cent,dx,dy],[]);
Framedata(nm,cent,dx,dy,options):=Framedata(nm,[cent,dx,dy],options);
Listplot(list):=Listplot(list,[]);
Listplot(Arg1,Arg2):=(
  regional(name,list,options,str);
  if(isstring(Arg1),
    name=Arg1;
    list=Arg2;
    Listplot(name,list,[]);
  ,
    list=Arg1;
    options=Arg2;
    name="";
    forall(list, // 16.10.07from
       name=name+#.name;
    );// 16.10.07until
    Listplot(name,list,options);
  );
);
Listplot(nm,list,options):=(
  regional(name,cutend,tmp,tmp1,tmp2,ptlist,Ltype,opcindy,Noflg,eqL,Msg,color,color4);
  if(substring(nm,0,1)=="-",  // 16.01.27 from
    name=substring(nm,1,length(nm));
  ,
    name="sg"+nm;
  ); // upto
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  eqL=tmp_5;
  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618
  opcindy=tmp_(length(tmp));
  Msg="Y";  //190206
 Msg="N"; //
  cutend=[0,0];//180719
  forall(eqL,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(substring(tmp_1,0,1));
    if(tmp1=="M",
      Msg=Toupper(substring(tmp_2,0,1));
    );
    if(tmp1=="C",//180719from
      tmp2=replace(tmp_2,"[","");
      tmp2=replace(tmp2,"]","");
      cutend=tokenize(tmp2,",");
      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);     
    );//180719to
  );
  if(Noflg<3,
    if(Msg=="Y", //190206
      println("generate Listplot "+name);
    );
    if(isstring(list_1),tmp=apply(list,parse(#)),tmp=list); // 15.03.24
    ptlist=apply(tmp,Pcrd(#));
    if(|cutend|>0,//180719from
      tmp=ptlist_(length(ptlist))-ptlist_1;
      tmp=tmp/|tmp|;
      ptlist_1=ptlist_1+tmp*cutend_1;
      ptlist_(length(ptlist))=ptlist_(length(ptlist))-tmp*cutend_2;
    );//180719to
    tmp=name+"="+Textformat(ptlist,5)+";"; //190415
    parse(tmp);
  );
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
  tmp1=apply(list,Lcrd(#));
  tmp1;
);
Shade(plist):=Shade(plist,[]); 
Shade(Arg1,Arg2):=(
  if(!isstring(Arg1),
    Shade(text(SHADECTR),Arg1,Arg2); //190222
  ,
    Shade(Arg1,Arg2,[]);
  );
);
Shade(nm,plistorg,options):=(
  regional(name,plist,jj,nn,trim,first,tmp,tmp1,tmp2,Noflg,
     opstr,opcindy,eqL,reL,Str,G2,flg,encflg,startpt,color,color4,ctr,ptshade);
  if(substring(nm,0,1)=="-", //200513from
    name=substring(nm,1,length(nm));
  ,
    name="shade"+nm;
  ); //200513to
  plist=plistorg;
  tmp=Divoptions(options);
  Noflg=tmp_2; //200512
  eqL=tmp_5; 
  reL=tmp_6;
  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618
  opstr=tmp_(length(tmp)-1);
  opcindy=tmp_(length(tmp));
  encflg=0; //201029
  tmp=select(plist,indexof(#,"Invert")>0); //180929from
  trim="N";
  first="N"; //191007
  ptshade="N"; //200513
  forall(eqL,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(tmp_1);
    tmp2=Toupper(tmp_2);
    if(substring(tmp1,0,1)=="E",
      if(substring(tmp2,0,1)=="Y",
        encflg=1;
      );
    );
    if(substring(tmp1,0,1)=="T",
      trim=substring(tmp2,0,1);
    );
    if(substring(tmp1,0,1)=="F",
      first=substring(tmp2,0,1);
    );
    if(substring(tmp1,0,1)=="P", //200513[3lines]
      ptshade=Toupper(substring(tmp2,0,1));
    );
  );
  startpt=[];
  forall(reL,
    if(islist(#),
      startpt=#;
    );
  ); //180929to
  flg=0; ctr=1;
  if(encflg==1, //180929from
    if(length(startpt)==2,
      Enclosing(nm,plist,[startpt,"nodisp"]);
    ,
      Enclosing(nm,plist,["nodisp"]);
    );
    plist=["en"+nm];
  ); //180929to
  if((length(plist)==1)&(trim=="Y"), //190220from,109224
    plist=[Shadein(plist)];
  ); //190220to
  forall(1..(length(plist)),jj, //180613from
    if(flg==0,
      tmp1=plist_jj;
      if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1);
      if(!islist(tmp),
         flg=1;
      ,
        if(!isstring(tmp1),
          tmp2=[];
          forall(tmp1,if(ispoint(#),tmp=#.xy,tmp=#);
            tmp2=append(tmp2,tmp);
          );
          Listplot("-"+name+text(ctr),tmp2,["nodisp"]); //190520
          plist_jj=name+text(ctr);
          ctr=ctr+1;
        );
      ); 
    );
  );//180613to
  if(flg==1,
    println("    some data not defined properly");
 ,
    if(Noflg<2, //200512
      G2=Joincrvs("1",plist,["nodata"]);
      G2=apply(G2,Pcrd(#));
      tmp1="fillpoly("+Textformat(G2,10)+opcindy+");";
      if(ptshade=="N", //200513from
        tmp=select(1..(length(GCLIST)),contains(plist,GCLIST_#_1)); //200715from
        if(length(tmp)>0,
          nn=min(tmp);
        ,
          nn=length(GCLIST)+1;
        );
        tmp2=GCLIST_(1..(nn-1));
        tmp2=append(tmp2,[tmp1,[5,0]]);
        GCLIST=concat(tmp2,GCLIST_(nn..(length(GCLIST))));
      ,
        PTSHADElist=append(PTSHADElist,[name,tmp1]);
      ); //200513to
    );
  );
  SHADECTR=SHADECTR+1;
);
Enclosing(nm,plist):=Enclosing2(nm,plist,[]);//180706[2lines]
Enclosing(nm,plistorg,options):=Enclosing2(nm,plistorg,options);
Enclosing2(nm,plist):=Enclosing2(nm,plist,[]);
Enclosing2(nm,plistorg,options):=(
  regional(name,plist,AnsL,Start,Eps,Eps1,Eps2,flg,Fdata,Gdata,KL,
      t1,t2,tst,ss,ii,nn,nxtno,Ltype,Noflg,realL,eqL,opstr,opcindy,
      tmp,tmp1,tmp2,color,color4,p1,p2);
  if(substring(nm,0,1)=="-",  //201110from
    name=substrin(nm,1,length(nm));
  ,
    name="en"+nm;
  );  //201110to
  plist=plistorg;
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  eqL=tmp_5;
  realL=tmp_6;
  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629
  opstr=tmp_(length(tmp)-1);
  opcindy=tmp_(length(tmp));
  Eps=10^(-5); // 16.12.05
  Eps1=0.01;
  Eps2=0.1;
  Start=[];
  flg=0;
  forall(realL,
    if(isList(#) % ispoint(#),
      Start=Lcrd(#); // 18.02.02
    ,
      if(flg==1,Eps1=#);
      if(flg==2,Eps2=#);
      flg=flg+1;
    );
  );
  flg=0;
  AnsL=[];
  if(length(plist)==1,
    Fdata=parse(plist_1);
    tmp1=Fdata_1;
    tmp2=Fdata_(length(Fdata));
    if(|tmp1-tmp2|<Eps,
      AnsL=Fdata;
    ,
      AnsL=append(Fdata,tmp1);
    );
    flg=1;
  );
  if(flg==0,
    Fdata=plist_1;
    Gdata=plist_(length(plist));
    KL=Intersectcurvespp(Fdata,Gdata);
    if(length(KL)==0,
      tmp=parse(Gdata);
      tmp1=LLcrd(Op(length(tmp),tmp)); //18.02.02from
      tmp=parse(Fdata);
      tmp2=LLcrd(Op(1,tmp));
      tmp=Listplot(name,[tmp1,tmp2],["nodisp"]);
      plist=append(plist,"sg"+name);
      Start=tmp2;
      tst=1; //18.02.02to
      p1=Start;
    ,
      if(length(KL)==1,
        tst=KL_1_2;
        Start=Pointoncurve(tst,Fdata);
      );
      if(length(KL)>1,
        KL=sort(KL,[#_2]);
        if(Start==[],
          tst=KL_1_2;
          Start=Pointoncurve(tst,Fdata);
        ,
          tmp=apply(KL,|#_1-Start|);
          tmp=min(tmp);
          tmp1=select(KL,|#_1-Start|<tmp+Eps1);//180718
          tst=tmp1_1_2;
          Start=Pointoncurve(tst,Fdata);
        );
      );
    );
  );
  if(flg==0,
    t1=tst;
    p1=Pointoncurve(t1,Fdata); //180713
    println("Start point of enclosing is "+text(Start));
    forall(1..(length(plist)),nn,
      Fdata=plist_nn;
      if(nn==length(plist),nxtno=1,nxtno=nn+1);
      Gdata=plist_nxtno;
      tmp1=parse(Fdata); //200803from
      tmp2=parse(Gdata);
      if(|tmp2_1-tmp1_(-1)|<Eps,
        AnsL=concat(AnsL,tmp1);
      ,  //200803to
        KL=Intersectcurvespp(Fdata,Gdata);
        if(length(KL)==0,
          tmp2=Prepend(Op(length(tmp1),tmp),tmp2);
          Gdata=replace(Gdata,"(","");
          Gdata=replace(Gdata,")","");
          tmp=Gdata+"="+Textformat(tmp2,10)+";"; //190415
          parse(tmp);
          plist_nxtno=Gdata;
          t2=Length(tmp1);
          p2=Pointoncurve(t2,Fdata); //180713
          ss=1; //18.02.02to
        ,
          KL=sort(KL,[#_2]);//180706
          tmp=parse(Fdata);
          tmp1=t1+Eps;
          tmp=select(KL,(#_2>tmp1)%((#_2>t1)&(|#_1-p1|>Eps1))); //210411from
          if(length(tmp)>0,
            KL=tmp;
          ); //210411to
          t2=KL_1_2;
          ss=KL_1_3;
          if(abs(t2-t1)<Eps,//180707
            if(length(KL)>1,
              t2=KL_2_2;
              ss=KL_2_3;
            ,
              println(text(nn)+" and "+text(nxtno)+" not intersect");
              flg=1;
            );
          );
        );
        if(flg==0,
          tmp=Partcrv("",t1,t2,Fdata,["nodata"]);
          if(nn==1,
            AnsL=tmp;
          ,
            AnsL=concat(AnsL,tmp_(2..(length(tmp))));
          );
        );
        t1=ss;//180706
        p1=Pointoncurve(t1,Gdata); //180713
      );
    );
    if(flg==0,
      AnsL=apply(AnsL,Pcrd(#));
    );
  );
  AnsL=Unscaling(AnsL); //201110
  if(Noflg<3,
    println("generate Enclosing "+name);
    tmp=name+"="+Textformat(AnsL,10)+";"; //190415
    parse(tmp);
    tmp=name+"=Enclosing2(";//16.11.07from
    tmp1="list"+PaO();
    forall(plistorg, //18.02.02
      tmp1=tmp1+#+",";
    );
  );
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
  AnsL; //201110
);
Intersectcurvespp(crv1org,crv2org):=Intersectcurvespp(crv1org,crv2org,[]);
Intersectcurvespp(crv1org,crv2org,options):=(
  regional(Eps,Eps1,Eps2,Dist,crv1,crv2,ii,jj,seg1,seg2,self,loopL,out,
          flg,tmp,tmp1,tmp2);
  Eps=10^(-4);
  Eps1=0.01;
  Eps2=0.1;
  Dist=10*Eps2;
  if(length(options)>0,
    Eps1=options_1;
    if(length(options)>1,
      Eps2=options_2;
      Dist=10*Eps2;
      if(length(options)>2,
        Dist=options_3;
      );
    );
  );
  if(isstring(crv1org),tmp1=parse(crv1org),tmp1=crv1org);//18.01.05from
  if(isstring(crv2org),tmp2=parse(crv2org),tmp2=crv2org);
  tmp1=apply(tmp1,LLcrd(#));
  tmp2=apply(tmp2,LLcrd(#));
  crv1=[tmp1_1];
  forall(tmp1,
    tmp=crv1_(length(crv1));
    if(|tmp-#|>Eps,
      crv1=append(crv1,#);
    );
  );
  crv2=[tmp2_1];
  forall(tmp2,
    tmp=crv2_(length(crv2));
    if(|tmp-#|>Eps,
      crv2=append(crv2,#);
    );
  );//18.01.05until
  if(crv1==crv2,
    self=1;
  ,
    self=0;
  );
  out=[];
  forall(1..(length(crv1)-1),ii,
    if(self==0,
      loopL=1..(length(crv2)-1);
    ,
      loopL=(ii+2)..(length(crv2)-1);
    );
    forall(loopL,jj,
      tmp=Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,Dist);
      if(length(tmp)>0,
        if(length(out)==0,
          out=[tmp];
        ,
          tmp1=out_(length(out));
          if(|tmp1_1-tmp_1|>Eps1,
            out=append(out,tmp);
          );
        );
        if(self==1,
          tmp=[tmp_1,tmp_3,tmp_2,tmp_4,tmp_5];
          out=append(out,tmp);
        );
      );
    );
  );
  tmp2=out;
  out=[];
  tmp1=tmp2;
  flg=0;
  forall(1..(length(tmp2)),
    if(flg==0,
      tmp=Collectsameseg(tmp1);
      out=append(out,tmp_1);
      if(length(tmp_2)==0,
        flg=1;
      ,
        tmp1=tmp_2;
      );
    );
  );
  forall(1..(length(out)),ii,
    tmp1=out_ii;
    if(length(tmp1)==1,
      out_ii=tmp1_1;
    ,
      tmp=apply(tmp1,#_4);
      dst=min(tmp);
      tmp1=select(tmp1,#_4<dst+Eps);
      tmp=apply(tmp1,#_1);
      tmp=sum(tmp)/length(tmp);
      tmp2=[tmp];
      tmp=Nearestpt(tmp2_1,crv1org);
      tmp2=append(tmp2,tmp_2);
      tmp=Nearestpt(tmp2_1,crv2org);
      tmp2=append(tmp2,tmp_2);
      tmp2=concat(tmp2,[dst,tmp1_1_5]);
      out_ii=tmp2;
    );
  );
  if(length(out)>0,  //190221from
    out=sort(out,[#_2]);
  );  //190221to
  out;
);
Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2):=(
  Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,10*Eps2);
);
Intersectpartseg(crv1org,crv2org,ii,jj,Eps1,Eps2,Dist):=(
  regional(crv1,crv2,Eps,dst,kk,ll,seg1,seg2,snang,
     p0,p1,p2,p3,os1,os2,out,tmp,tmp1,tmp2,flg);
  crv1=crv1org; crv2=crv2org;
  if(isstring(crv1),crv1=parse(crv1));
  if(isstring(crv2),crv2=parse(crv2));
  Eps=10^(-4);
  out=[];
  seg1=[crv1_ii,crv1_(ii+1)];
  seg2=[crv2_jj,crv2_(jj+1)];
  tmp1=seg1_2-seg1_1;
  tmp2=seg2_2-seg2_1;
  snang=abs(Crossprod(tmp1,tmp2))/(Norm(tmp1)*Norm(tmp2));
  tmp=Intersectseg(seg1,seg2,Eps1);
  dst=tmp_1;
  if(dst<Eps,
    out=[tmp_2,ii+tmp_3,jj+tmp_4,dst,snang];
  ,
    if(dst<Eps2,
      if((length(crv1)==2)%(|seg1_2-seg1_1|>Dist-Eps),
        os1=seg1;
      ,
        p1=seg1_1; p2=seg1_2;
        if(ii==1,
          p3=crv1_3;
          tmp=p2-p1;
          tmp=(p1+p2)/2+[tmp_2,-tmp_1];
          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);
        ,
          if(ii==length(crv1)-1,
            p0=crv1_(ii-1);
            tmp=p2-p1;
            tmp=(p1+p2)/2+[tmp_2,-tmp_1];
            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);
          ,
            p0=crv1_(ii-1); p3=crv1_(ii+2);
          );
        );
        os1=Osplineseg([p0,p1,p2,p3]);
      );
      if((length(crv2)==2)%(|seg2_2-seg2_1|>Dist-Eps), //18.01.05
        os2=seg2;
      ,
        p1=seg2_1; p2=seg2_2;
        if(jj==1,
          p3=crv2_3;
          tmp=p2-p1;
          tmp=(p1+p2)/2+[tmp_2,-tmp_1];
          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);
        ,
          if(jj==length(crv2)-1,
            p0=crv2_(jj-1);
            tmp=p2-p1;
            tmp=(p1+p2)/2+[tmp_2,-tmp_1];
            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);
          ,
            p0=crv2_(jj-1); p3=crv2_(jj+2);
          );
        );
        os2=Osplineseg([p0,p1,p2,p3]);
      );
      tmp2=[];
      forall(1..(length(os1)-1),kk,
        forall(1..(length(os2)-1),ll,
          seg1=[os1_kk,os1_(kk+1)];
          seg2=[os2_ll,os2_(ll+1)];
          tmp=Intersectseg(seg1,seg2,Eps1);
          if((tmp_1<Eps1)&(length(tmp)>1), //18.02.06
            if(tmp_1<dst+Eps,
              dst=tmp_1;
              tmp2=select(tmp2,#_1<dst);
              tmp2=append(tmp2,[dst,tmp_2]);
            );
          );
        );
      );
      if(length(tmp2)>0,
        tmp=apply(tmp2,#_2_1);
        tmp1=[sum(tmp)/length(tmp2)];
        tmp=apply(tmp2,#_2_2);
        tmp1=append(tmp1,sum(tmp)/length(tmp2));
        out=[tmp1];
        p1=crv1_ii; p2=crv1_(ii+1);
        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];
        tmp=Intersectline(out_1,tmp,p1,p2-p1);
        tmp=min([max([tmp_3,0]),1]);
        out=[tmp1,ii+tmp];
        p1=crv2_jj; p2=crv2_(jj+1);
        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];
        tmp=Intersectline(out_1,tmp,p1,p2-p1);
        tmp=min([max([tmp_3,0]),1]);
        out=concat(out,[jj+tmp,dst,snang]);
      );
    );
  );
  out;
);
Crossprod(a,b):=(
  regional(tmp1,tmp2,tmp3,Out);
  if(length(a)==3,
    tmp1=a_2*b_3-a_3*b_2;
    tmp2=a_3*b_1-a_1*b_3;
    tmp3=a_1*b_2-a_2*b_1;
    Out=[tmp1,tmp2,tmp3];
  ,
    Out=a_1*b_2-a_2*b_1;
  );
  Out;
);
Reflectpoint(point,symL):=(
  regional(X1,X2,Y1,Y2,Us,Vs,Pt1,Pt2,Cx,Cy,flg,tmp);
  tmp=Lcrd(point);
  X1=tmp_1; Y1=tmp_2;
  if(!islist(symL), //210104from
    Pt1=Lcrd(symL);
    Pt2=Pt1;
  ,
    if(length(symL)==1,
      Pt1=Lcrd(symL_1);
      Pt2=Pt1;
    ,
      if(isreal(symL_1),
        Pt1=Lcrd(symL);
        Pt2=Pt1;
      ,
        Pt1=Lcrd(symL_1);
        Pt2=Lcrd(symL_2);
      );
    );
  ); //210104to
  Us=Pt2_1-Pt1_1;
  Vs=Pt2_2-Pt1_2;
  if(Pt1==Pt2,
    X2=2*Pt1_1-X1;
    Y2=2*Pt1_2-Y1;
  ,
    X2=(Us^2-Vs^2)/(Us^2+Vs^2)*X1+2*Us*Vs/(Us^2+Vs^2)*Y1
              -2*Vs*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);
    Y2=2*Us*Vs/(Us^2+Vs^2)*X1-(Us^2-Vs^2)/(Us^2+Vs^2)*Y1
              +2*Us*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);
  );
  [X2,Y2];
);
Osplineseg(list):=Osplineseg(list,[]);
Osplineseg(ptlist,optionsorg):=(
  regional(tmp,tmp1,tmp2,list,ptL,ctrL,Eps,Eps0,
      p0,p1,p2,p3,pQ,pR,cc,p01,p02,p11,p12,p21,p22,p31,p32,out);
  Eps=10^(-2);
  Eps0=10^(-6);
  if(isstring(ptlist),list=parse(ptlist),list=ptlist);
  p0=list_1; p1=list_2; p2=list_3; p3=list_4;
  tmp=1+sqrt((1+Dotprod(p2-p0,p3-p1)/|p2-p0|/|p3-p1|)/2);
  cc=4*|p2-p1|/3/(|p2-p0|+|p3-p1|)/tmp;
  pQ=p1+cc*(p2-p0); // 15.09.21  // 16.08.16
  pR=p2+cc*(p1-p3);  // 16.08.16
  ctrL=[pQ,pR];
  options=optionorg;
  options=concat(options,["Num=20","nodata"]);
  out=Bezier("",[p1,p2],ctrL,options);
  out;
);
Dotprod(vec1,vec2):=(
  regional(v1,v2,tmp);
  if(ispoint(vec1),v1=vec1.xy,v1=vec1);
  if(ispoint(vec2),v2=vec2.xy,v2=vec2);
  v1*v2;
);
Bezier(ptctrlist):=Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,[]);
Bezier(Arg1,Arg2):=( //190202from
  regional(nm,ptctrlist,options);
  if(islist(Arg1),
    ptctrlist=Arg1; options=Arg2;
    Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,options);
  ,
    nm=Arg1; ptctrlist=Arg2;
    Beziercurve(nm,ptctrlist_1,ptctrlist_2,[]);
  );
); //190202to
Bezier(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);
Bezier(nm,ptlist,ctrlist,options):=Beziercurve(nm,ptlist,ctrlist,options);
Beziercurve(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);
Beziercurve(nm,ptlistorg,ctrlistorg,options):=(
  regional(name,Ltype,Noflg,opstr,opcindy,Num,msgflg,
    ptlist,ctrlist,tmp,tmp1,tmp2,ii,st,out,list,color,color4);
  name="bz"+nm;
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618
  opstr=tmp_(length(tmp)-1);
  opcindy=tmp_(length(tmp));
  Num=10;
  msgflg="Y";
  tmp1=tmp_5;
  forall(tmp1,     // 14.12.31
    if(substring(#,0,1)=="N",
      tmp2=indexof(#,"=");
      Num=parse(substring(#,tmp2,length(#)));
      opstr=opstr+","+Dq+#+Dq;
    );
    if(substring(#,0,1)=="M",
      tmp2=indexof(#,"=");
      msgflg=Toupper(substring(#,tmp2,tmp2+1));
    );  );
  ptlist=apply(ptlistorg,Lcrd(#)); // 16.08.16
  ctrlist=[];  // 14.12.31
  if(length(ctrlistorg)==length(ptlist)-1,
    forall(1..(length(ctrlistorg)),ii, //190202
      tmp1=apply(ctrlistorg_ii,Lcrd(#));  //190202
      if(Measuredepth(tmp1)==0,tmp=[tmp1],tmp=tmp1);
      ctrlist=append(ctrlist,tmp);
    );
  ,
    forall(1..(length(ptlist)-1),ii,
      tmp=ctrlistorg_((2*ii-1)..(2*ii));
      tmp=apply(tmp,Lcrd(#)); // 16.08.16
      ctrlist=append(ctrlist,tmp);
    );
  );
  if(!islist(Num),
    Num=apply(ctrlist,Num);
  );
  list=[];
  forall(1..(length(ptlist)-1),ii,
    tmp1=ptlist_(ii..(ii+1));
    tmp2=ctrlist_ii;
    if(ii==1,st=0,st=1);
    forall(st..Num_ii,
      tmp=Bezierpt(#/Num_ii,tmp1,tmp2);
      list=append(list,tmp);
    );
  );
  if(Noflg<3,
    if(msgflg=="Y",println("generate Bezier "+name));
    out=apply(list,Pcrd(#));
    tmp=name+"="+Textformat(out,10)+";"; //190415
    parse(tmp);
  );
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
  BezierCtrL=ctrlist; //181001
  list;
);
Bezierpt(t,ptlist,ctrlist):=(
  regional(flg3,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9);
  p0=ptlist_1;
  p3=ptlist_2;
  p1=ctrlist_1;
  if(length(ctrlist)==1,
    p2=p3;
    flg3=0;
  ,
    p2=ctrlist_2;
    flg3=1;
  );
  if(length(p0)<3,  // 15.02.08
    p0=Lcrd(p0);
    p3=Lcrd(p3);
    p1=Lcrd(p1);
    p2=Lcrd(p2);
  );
  p4=(1-t)*p0+t*p1;
  p5=(1-t)*p1+t*p2;
  p6=(1-t)*p2+t*p3;
  p7=(1-t)*p4+t*p5;
  p8=(1-t)*p5+t*p6;
  p9=(1-t)*p7+t*p8;
  if(flg3==0,p7,p9);
);
Intersectseg(seg1,seg2):=Intersectseg(seg1,seg2,0.01);
Intersectseg(seg1org,seg2org,Eps1):=(
  regional(Eps,seg1,seg2,p1,p2,q1,q2,t,s,pt,n,pts,out,dist,
    tmp,tmp1,tmp2,tmp3);
  Eps=10^(-4);
  seg1=seg1org;
  seg2=seg2org;
  if(isstring(seg1),seg1=parse(seg1));
  if(isstring(seg2),seg2=parse(seg2));
  out=[];
  p1=seg1_1; q1=seg1_2;
  p2=seg2_1; q2=seg2_2;
  if((|q1-p1|<Eps)%(|q2-p2|<Eps),
    out=[-1];
  ,
    tmp=Intersectline(p1,q1-p1,p2,q2-p2);
    if(islist(tmp_1),
      pt=tmp_1; t=tmp_2; s=tmp_3;
      if((t*(t-1)<Eps)&(s*(s-1)<Eps),
        out=[0,pt,t,s];
      ,
        t=min([max([t,0]),1]);
        s=min([max([s,0]),1]);
        tmp3=[|p1-p2|,|p1-q2|,|q1-p2|,|q1-q2|]; //18.01.30from
        tmp1=[Op(2,q2-p2),-Op(1,q2-p2)];
        tmp=Intersectline(p1,tmp1,p2,q2-p2);
        if(islist(tmp_1),
          if(tmp_3*(tmp_3-1)<Eps,
            tmp3=append(tmp3,|tmp_1-p1|);
          );
        );
        tmp=Intersectline(q1,tmp1,p2,q2-p2);
        if(islist(tmp_1),
          if(tmp_3*(tmp_3-1)<Eps,
            tmp3=append(tmp3,|tmp_1-q1|);
          );
        );
        tmp1=[Op(2,q1-p1),-Op(1,q1-p1)];
        tmp=Intersectline(p2,tmp1,p1,q1-p1);
        if(islist(tmp_1),
          if(tmp_3*(tmp_3-1)<Eps,
            tmp3=append(tmp3,|tmp_1-p2|);
          );
        );
        tmp=Intersectline(q2,tmp1,p1,q1-p1);
        if(islist(tmp_1),
          if(tmp_3*(tmp_3-1)<Eps,
            tmp3=append(tmp3,|tmp_1-q2|);
          );
        );
        out=[min(tmp3),pt,t,s]; //18.01.30until
      );
    ,
      dist=tmp_1;
      tmp1=q1-p1;      
      n=[tmp1_2,-tmp1_1]/|tmp1|;
      pts=[];
      tmp=Intersectline(p1,n,p2,q2-p2);
      if(tmp_3*(tmp_3-1)<Eps,
        tmp1=(1-tmp_3)*p2+tmp_3*q2;
        pts=append(pts,[tmp1,0,tmp_3]);
      );
      tmp=Intersectline(q1,n,p2,q2-p2);
      if(tmp_3*(tmp_3-1)<Eps,
        tmp1=(1-tmp_3)*p2+tmp_3*q2;
        pts=append(pts,[tmp1,1,tmp_3]);
      );
      tmp=Intersectline(p2,n,p1,q1-p1);
      if(tmp_3*(tmp_3-1)<Eps,
        tmp1=(1-tmp_3)*p1+tmp_3*q1;
        pts=append(pts,[tmp1,tmp_3,0]);
      );
      tmp=Intersectline(q2,n,p1,q1-p1);
      if(tmp_3*(tmp_3-1)<Eps,
        tmp1=(1-tmp_3)*p1+tmp_3*q1;
        pts=append(pts,[tmp1,tmp_3,2]);
      );
      if(length(pts)==0,
        tmp1=min([|p2-p1|,|q2-p1|,|p2-q1|,|q2-q1|]);
        out=[tmp1];
      ,
        if(dist>Eps1,
          out=[dist];
        ,
          tmp=apply(pts,#_1_1);
          tmp1=sum(tmp)/(length(pts));
          tmp=apply(pts,#_1_2);
          tmp2=sum(tmp)/(length(pts));
          tmp3=[tmp1,tmp2];
          tmp=Nearestpt(tmp3,seg1);
          tmp1=tmp_2;
          tmp=Nearestpt(tmp3,seg2);
          tmp2=tmp_2;
          out=[dist,tmp3,tmp1,tmp2];
        );
      );
    );
  );
  out;
);
Op(n,object):=( //  16.05.25
  regional(out);
  if(islist(object),
    out=object_n;
  ,
    if(isstring(object),
      out=substring(object,n-1,n);
    );
  );
  out;
);
Intersectline(p1,v1,p2,v2):=(
  regional(Eps,d,dt,ds,t,s,pt,out,tmp,tmp1,tmp2,tmp3);
  Eps=10^(-5);
  out=[];
  tmp=Dotprod(v1,v2);
  tmp1=[tmp,|v1|^2];
  tmp2=[-|v2|^2,-tmp];
  tmp3=[Dotprod(p2-p1,v2),Dotprod(p2-p1,v1)];
  d=Crossprod(tmp1,tmp2);
  tmp=abs(Crossprod(v1,v2));
  if(tmp>Eps,
    dt=Crossprod(tmp3,tmp2);
    ds=Crossprod(tmp1,tmp3);
    t=dt/d;
    s=ds/d;
    pt=p1+v1*t;
    out=[pt,t,s];
  ,
    tmp1=Crossprod(p2-p1,v1)/|v1|; //18.01.05
    out=[abs(tmp1)]; //18.01.05
  );
  out;
);
Nearestpt(pt,plotstr):=(
  regional(ptL,Eps,dtL,dt,nn,pt1,pt2,dv,nv,tmp,tmp1,tmp2);
  if(isstring(plotstr),ptL=parse(plotstr),ptL=plotstr);
  Eps=10^(-6);
  dtL=[];
  forall(1..(length(ptL)-1),nn,
    pt1=ptL_nn;
    pt2=ptL_(nn+1);
    if(|pt2-pt1|<Eps,
      dt=[pt1,nn,|pt1-pt|];
    ,
      dv=pt2-pt1;
      nv=[-dv_2,dv_1];
      tmp1=Intersectline(pt1,dv,pt,nv);
      if(length(tmp1)>1, //210319from
        if((tmp1_2>=0)&(tmp1_2<=1),
          dt=[tmp1_1,nn+tmp1_2,|tmp1_1-pt|];
        ,
          if(tmp1_2<0,
            dt=[pt1,nn,|pt1-pt|];
          ,
            dt=[pt2,nn+1,|pt2-pt|];
          );
        );
      ,
      ); //210319to
    );
    dtL=append(dtL,dt);
  );
  dtL=sort(dtL,[#_3,#_2]);
  dtL_1;
);
Collectsameseg(ptdL):=(
  regional(Eps,gL,rL,numL,ii,jj,flg,tmp,tmp1,tmp2,tmp1md,
       dst,kk,s1,e1,s2,e2);
  Eps00=10^(-8);
  if(length(ptdL)==0,
    gL=[];rL=[];
  ,
    tmp1md=[ptdL_1];
    rL=ptdL_(2..(length(ptdL)));
    tmp1=tmp1md_1;
    kk=floor(tmp1_2);
    if(tmp1_2<kk+Eps00,
      s1=kk-1-Eps00; e1=s1+2+2*Eps00;
    ,
      s1=kk-Eps00; e1=s1+1+2*Eps00;
    );
    kk=floor(tmp1_3);
    if(tmp1_3<kk+Eps00,
      s2=kk-1-Eps00; e2=s2+2+2*Eps00;
    ,
      s2=kk-Eps00; e2=s2+1+2*Eps00;
    );
    numL=[];
    forall(1..(length(rL)),ii,
      tmp=rL_ii;
      tmp1=tmp_2;tmp2=tmp_3;
      if((tmp1>s1)&(tmp1<e1)&(tmp2>s2)&(tmp2<e2),
        tmp1md=append(tmp1md,tmp);
        numL=append(numL,ii);
      );
    );
    gL=[];
    tmp=apply(tmp1md,#_4);
    dst=min(tmp);
    forall(tmp1md,
      if(#_4<dst+Eps00,
        gL=append(gL,#);
      );
    ); 
    rL=remove(rL,rL_(numL));
  );
  [gL,rL];
);
Partcrv(nm,pA,pB,PkLstr):=Partcrv(nm,pA,pB,PkLstr,[]);
Partcrv(nm,pAorg,pBorg,PkLstr,options):=(
  regional(pA,pB,PkL,PkLL,Ans,Eps,Npt,Out1,Out2,tmp,tmp1,tmp2,Flg,nS,nE,
        PPL,pP,opcindy,Ta,Tb,name,Ltype,Noflg,eqL,msg,DepthFlg,color,color4);
  if(substring(nm,0,1)=="-", //201106from
    name=substring(nm,1,length(nm));
  ,
    name="part"+nm;
  ); //201106to
  pA=pAorg; pB=pBorg; //201031
  if(isstring(PkLstr),PkL=parse(PkLstr),PkL=PkLstr);
  DepthFlg=0;
  if(Measuredepth(PkL)==2,
    PkL=PkL_1;
    DepthFlg=1;
  );
  PkLL=apply(PkL,LLcrd(#)); //201031
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  eqL=tmp_5;
  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626
  opcindy=tmp_(length(tmp));
  msg="Y";
  forall(eqL,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(substring(tmp_1,0,1));
    tmp2=Toupper(substring(tmp_2,0,1));
    if(tmp1=="M",
      msg=tmp2;
    );
  );
  Eps=10^(-4);
  Flg=0;
  if(isreal(pA),
    if(pA>pB+Eps,
      Npt=Numptcrv(PkL);
      Out1=Partcrv("",pA,Npt,PkLstr,["nodata"]);
      Out2=Partcrv("",1,pB,PkLstr,["nodata"]);
      tmp=Ptstart(PkL)-Ptend(PkL);
      if(|tmp|<Eps,
        Ans=Joincrvs("",[Out1,Out2],["nodata"]);
      ,
        Ans=[apply(Out1,Pcrd(#)),apply(Out2,Pcrd(#))];
      );
      Flg=1;
    );
    if(Flg==0,
      nS=ceil(pA);
      nE=floor(pB);
      PPL=[];
      if(pA<nS-Eps,
        pP=(nS-pA)*PkL_(nS-1)+(1-nS+pA)*PkL_nS;
        PPL=[pP];
      );
      PPL=concat(PPL,PkL_(nS..nE));
      if(pB>nE+Eps,
        pP=(1-pB+nE)*PkL_nE+(pB-nE)*PkL_(nE+1);
        PPL=concat(PPL,[pP]);
      );
      Ans=PPL;
      Flg=1;
    );
  );
  if(Flg==0,
    pA=Pcrd(pA); //201031from
    pB=Pcrd(pB); 
    tmp=Nearestpt(LLcrd(pA),PkLL); //201031to
    Ta=tmp_2;
    tmp=Nearestpt(LLcrd(pB),PkLL); // 15.09.12
    Tb=tmp_2;
    Ans=Partcrv("",Ta,Tb,PkL,["nodata"] );
  );
  if(Noflg<3,
    tmp1=apply(Ans,Pcrd(#)); //201030
    tmp=name+"="+Textformat(Ans,5)+";"; //190415
    parse(tmp);
    if(DepthFlg==0,
      tmp=PkLstr;
    ,
      tmp=PkLstr+"(1)";
    );
    tmp1=name+"=Partcrv("+Textformat(Lcrd(pA),5)
         +","+Textformat(Lcrd(pB),5)+","+tmp+")"; // 16.04.03
  );
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
  Ans;
);
Numptcrv(Fig):=(
  regional(tmp);
  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 15.12.23
  length(tmp);
);
Ptstart(Fig):=(
  regional(tmp);
  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 16.01.21
  tmp_1;
);
Ptend(Fig):=(
  regional(tmp);
  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);
  tmp_(length(tmp)); // 15.04.12
);
Joincrvs(nm,plotstrL):=Joincrvs(nm,plotstrL,[]);
Joincrvs(nm,plotstrL,options):=(
  regional(plotlist,PtL,Eps,QdL,Flg,Ni,Qd,pP,pS,pQ,pR,rMN,
        opcindy,tmp,tmp1,tmp2,str,name,Ltype,Noflg,color,color4);
  name="join"+nm;
  plotlist=[];
  forall(plotstrL,str,
    if(isstring(str),
      tmp=parse(str);
      tmp=apply(tmp,LLcrd(#));
    ,
      tmp=str;
    );
    plotlist=append(plotlist,tmp);
  );
  Eps=10^(-4);
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629
  opcindy=tmp_(length(tmp));
  tmp1=tmp_6;
  if(length(tmp1)>0,Eps=tmp1_1);
  QdL=[];
  forall(plotlist,Qd,
    if(ispoint(Qd_1) % !islist(Qd_1_1),
      QdL=concat(QdL,[Qd]);
    ,
      forall(Qd,
        QdL=concat(QdL,[#]);
      );
    );
  );
  Flg=0;
  if(length(QdL)==0,
    PtL=[];
    Flg=1;
  );
  if(Flg==0,
    PtL=QdL_1;
    forall(2..(length(QdL)),Ni,
      Qd=QdL_Ni;
      if(Numptcrv(Qd)>1,
        pP=Ptend(PtL);
        pS=Ptstart(PtL);
        pQ=Ptstart(Qd);
        pR=Ptend(Qd);
        rMN=min([|pP-pQ|,|pP-pR|,|pS-pQ|,|pS-pR|]);
        if(rMN==|pP-pR|,
          Qd=reverse(Qd);
        ,
          if(rMN==|pS-pQ|,
            PtL=reverse(PtL);
          ,
            if(rMN==|pS-pR|,
              PtL=reverse(PtL);
              Qd=reverse(Qd);
            );
          );
        );
      );
      if(rMN>Eps,
        PtL=concat(PtL,Qd);
      ,
        PtL=concat(PtL,Qd_(2..(length(Qd))));
      );
    );
  );
  if(Noflg<3,
    println("generate joincurve "+name);
    tmp1=apply(PtL,Pcrd(#));
    tmp=name+"="+Textformat(tmp1,5)+";";
    parse(tmp);
    tmp1="";
    forall(plotstrL,
        tmp1=tmp1+#+",";
    );
    tmp1=substring(tmp1,0,length(tmp1)-1);
  );
  if(Noflg<3, //190818
    if(isstring(Ltype),
      Ltype=Getlinestyle(text(Noflg)+Ltype,name);
    ,
      if(Noflg==1,Ltype=0);
    );
    GCLIST=append(GCLIST,[name,Ltype,opcindy]);
  );
  PtL;
);
Pointoncurve(tTorg,Gdata):=(
  regional(tT,Out,Eps,nN,sS,Pa,Pb,PtL);
  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);
  if(length(PtL)==1,PtL=PtL_1);
  tT=max([tTorg,1]); //18.01.04
  tT=min([tT,length(PtL)]); //18.01.04
  Eps=10^(-5); //18.01.04
  nN=floor(tT+Eps);
  sS=max([tT-nN,0]);
  if(nN==length(PtL),
    Out=PtL_nN;
  ,
    Pa=PtL_nN;
    Pb=PtL_(nN+1);
    Out=(1-sS)*Pa+sS*Pb;
  );
  Out;
);
Unscaling(pdata):=(
  regional(Level,Out);
  Out=[];
  if(!islist(pdata_1),
    Out=[pdata_1/SCALEX,pdata_2/SCALEY];
  ,
    forall(pdata,
      Out=append(Out,Unscaling(#))
    );
  );
  Out;
);
Shadein(pstrorg):=( //190220
  regional(pstr,ptL,pL,crv,nn,
      tmp,tmp1,tmp2,pm1,pm2,p1,p2,flg);
  if(islist(pstrorg),pstr=pstrorg_1,pstr=pstrorg);
  crv=[];
  Framedata(["nodisp"]);
  ptL=Intersectcurvespp(pstr,frwin);
  if(length(ptL)>0,
    pL=apply(ptL,#_2);
    forall(1..(length(pL)),nn,
      if(nn<length(pL),
       tmp1=pL_nn;
       tmp2=pL_(nn+1);
       tmp=Pointoncrv((tmp1+tmp2)/2,pstr);
      ,
        tmp1=pL_nn;
        tmp2=pL_1;
        tmp=parse(pstr);
        if(pL_nn==length(tmp),
          tmp=tmp_1;
        ,
          tmp=tmp_(length(tmp));
        );
      );
      if(Inwindow(tmp),
        tmp=Partcrv("",tmp1,tmp2,pstr,["nodata"]);
      ,
        tmp1=Pointoncrv(tmp1,pstr);
        tmp2=Pointoncrv(tmp2,pstr);
        pm1=Paramoncrv(tmp1,frwin);
        pm2=Paramoncrv(tmp2,frwin);
        if(floor(pm1)==floor(pm2),
          tmp=Listplot("",[tmp1,tmp2],["nodata"]);
        ,
          tmp=floor(pm1);
          p1=Pointoncrv(tmp,"frwin");
          p2=Pointoncrv(mod(tmp,4)+1,"frwin");
          tmp=p1-10*(p2-p1);
          Listplot("frwin",[p1,tmp],["nodisp","Msg=n"]);
          tmp=Intersectcurvespp("sgfrwin",pstr);
          if(mod(length(tmp),2)==0, //190223from
            if(pm2<pm1,pm2=pm2+4); 
            tmp=[tmp1];
            pm1=floor(pm1)+1;
            flg=0;
            forall(1..3,
              if(flg==0,
                if(pm1<pm2,
                  p1=Pointoncrv(mod(pm1-1,4)+1,"frwin");
                  tmp=append(tmp,p1);
                  pm1=pm1+1;
                ,
                  flg=1;
                );
              );
            );
            if(pm1-1<pm2,tmp=append(tmp,tmp2));
          ,
            if(pm2>pm1,pm2=pm2-4);
            tmp=[tmp1];
            pm1=floor(pm1);
            flg=0;
            forall(1..3,
              if(flg==0,
                if(pm1>pm2,
                  p1=Pointoncrv(mod(pm1-1,4)+1,"frwin");
                  tmp=append(tmp,p1);
                  pm1=pm1-1;
                ,
                  flg=1;
                );
              );
            );
            if(pm1+1>pm2,tmp=append(tmp,tmp2));
          ); //190223to
        );
      );
      if(length(crv)==0,
        crv=tmp;
      ,
        crv=Joincrvs("",[crv,tmp],["nodata"]);
      );
    );
  ,
    if(Inwindow(parse(pstr+"_1")),crv=pstr,crv=frwin);
  );
  crv;
);
Paramoncrv(pP,Gdata):=Paramoncurve(pP,Gdata);//180723
Paramoncurve(point,Gdata):=(
  regional(Tmp,PtL,pP);
  if(ispoint(point),pP=point.xy,pP=point);
  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);
  Tmp=Nearestpt(pP,PtL);
  Tmp_2;
);
Paramoncurve(pP,nN,plist):=(
  regional(PtL,Out,Pa,Pb,vV,vW,sS);
  if(isstring(plist),PtL=parse(plist),PtL=plist);
  PtL=apply(PtL,LLcrd(#));//16.10.16
  if(nN==length(PtL),
    Out=nN;
  ,
    Pa=PtL_nN;
    Pb=PtL_(nN+1);
    vV=Pb-Pa;
    vW=pP-Pa;
    sS=vV*vW/|vV|^2;
    sS=min([max([sS,0]),1]);
    Out=nN+sS;
  );
  Out;
);
Pointoncrv(tT,PtL):=Pointoncurve(tT,PtL);
Inwindow(point):=Inwindow(point,[XMIN,XMAX],[YMIN,YMAX]);
Inwindow(point,xrng,yrng):=(
  regional(Eps,pt,x,y,xmin,xmax,ymin,ymax,tmp);
  Eps=10.0^(-6);
  if(ispoint(point),pt=point.xy,pt=point);
  x=pt_1; y=pt_2;
  xmin=xrng_1; xmax=xrng_2;
  ymin=yrng_1; ymax=yrng_2;
  tmp=(x>xmin-Eps)&(x<xmax+Eps)&(y>ymin-Eps)&(y<ymax+Eps);
  if(tmp,true,false);
);
Windispg():=(
  if(ADDAXES=="1", //181215from
    Drwxy();
    ADDAXES="0";
  ); //181215to
  Windispg(GCLIST); //190125
);
Windispg(gcLorg):=( //190125
  regional(gcL,Nj,Nk,Dt,Vj,tmp,tmp1,tmp2,tmp3,tmp4,typeL,opcindy,flg);
  gcL=gcLorg; //190125from
  if(length(gcL)>0,
    if(!islist(gcL_1),gcL=[gcL]);
  ); //190125to
  gcL=select(gcL,#_2_1>=0); //190818
  gsave();
  layer(KETPIClayer);
  forall(gcL,Nj,
    flg=0;
    if(isstring(Nj_1),
      if(Nj_2_1>4, //200716from
        parse(Nj_1);
        flg=1; 
      ,
        Dt=parse(Nj_1);
      );  //200716to
    ,
      Dt=Nj_1
    );  // 11.17
    if((flg==0)&(islist(Dt))&(length(Dt)>0),  // 12.19,12.22,200716
      tmp=Measuredepth(Dt);
      if(tmp==1,Dt=[Dt]);
      opcindy=Nj_3;
      typeL=Nj_2; //200620from
      if(isstring(typeL_2),tmp=tokenize(typeL_2,","),tmp=[typeL_2]); //200623
      typeL=prepend(typeL_1,tmp); //200620from
      if(typeL_1<0,typeL_1=0);
      tmp1=typeL_1;
      if(tmp1<10,
        forall(Dt,Nk,
          if(length(Nk)>1,
            tmp3="";
            if(indexof(opcindy,"color")==0, //190122from
              tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]
              tmp3=tmp3+",linecolor->"+text(tmp);
            );
            tmp3=tmp3+opcindy;
            if(tmp1==0,  //190126from
              if(indexof(opcindy,"size")==0, 
                tmp3=tmp3+",size->"+text(typeL_2);
              ); //190124to
              tmp="connect("+Textformat(Nk,10)+tmp3+");";//190125
              parse(tmp);
            );
            if((tmp1==1)%(tmp1==2),
              if(length(typeL)<4,typeL=append(typeL,1)); //
              if(typeL_(-1)!=1,
                tmp="linesize("+text(typeL_4)+")";
                parse(tmp);
              );
              tmp3=",dashtype->1"+tmp3;
              forall(1..(length(Nk)-1),
                tmp="draw("+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+");";
                parse(tmp);
              );
              if(typeL_(-1)!=1,
                tmp="linesize(1)";
                parse(tmp);
              );  //
            );
            if(tmp1==3,
              if(typeL_3!=1,
                tmp="linesize("+text(typeL_3)+")";
                parse(tmp);
              );
              tmp3=",dashtype->3"+tmp3;
              forall(1..(length(Nk)-1),
                tmp="draw("+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+");";
                parse(tmp);
              );
              if(typeL_3!=1,
                tmp="linesize(1)";
                parse(tmp);
              );
            );
          ,
            if(indexof(opcindy,"size")==0,  //190425from
              opcindy=opcindy+",size->"+text(TenSize/TenSizeInit);
            ); //190425to
            tmp="draw("+text(Nk_1)+opcindy+");"; 
            parse(tmp);
           ); //190126to
        );
      );
    );
  );
  forall(PTSHADElist, //200519from
    parse(#_2);
  ); //200519to

  grestore(); 
  layer(0);
);
Drwxy():=Drwxy(0,[]);
Drwxy(Arg):=( //190901from
  if(islist(Arg),
    Drwxy(0,Arg);
  ,
    Drwxy(Arg,[]);
  ); //190901to
);
Drwxy(add,optionsorg):=(
  regional(options,color,eqL,strL,org,xrng,yrng,ax,st,nn,size,labelsize,
  linesty,colorax,colorla,tmp,tmp1,tmp2);
  options=optionsorg;
  tmp=Divoptions(options);
  color=tmp_(length(tmp)-2);
  eqL=tmp_5;
  org=GENTEN; 
  xrng=[XMIN,XMAX];  //190103
  yrng=[YMIN,YMAX];  //190103
  ax=AXSTYLE_1; //190901from
  labelsize=1.5; //210408
  forall(AXSTYLE_2,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(substring(tmp_1,0,1));
    if(contains(["S","L"],tmp1), 
      labelsize=parse(tmp_2);
      options=remove(options,[#]);
    );
  );  //190901to
  linesty=ax_8;
  if(length(ax_9)>0, //190427
    if(isstring(ax_9),colorax=ax_9,colorax=text(ax_9));
  ,
    colorax=KCOLOR; //190427
  );
  colorax="Color="+colorax; //190427[if removed]
  if(isstring(ax_10),colorla=ax_10,colorla=text(ax_10));
  if(length(colorla)>0, //181217from
    colorla="Color="+colorla;
  ,
    if(length(colorax)>0,
      colorla=colorax;
    );
  ); //181217to
  forall(eqL,
    if(tmp1=="O", //190103from
      org=parse(tmp_2);
      options=remove(options,[#]);
    );  //190103to
    if(tmp1=="X",
      xrng=parse(tmp_2);
      options=remove(options,[#]);
    );
    if(tmp1=="Y",
      yrng=parse(tmp_2);
      options=remove(options,[#]);
    );
    if(tmp1=="A",
      tmp2=tokenize(tmp_2,",");
      st=1; nn=1;
      if(isreal(tmp2_1),
        st=2;
        nn=tmp2_1;
      );
      forall(st..(length(tmp2)),
        tmp=tmp2_#;
        if(length(tmp)>0,ax_nn=tmp);
        nn=nn+1;
      );
      options=remove(options,[#]);
    );
  );
  options=append(options,linesty); //181216
  if(substring(ax_1,0,1)=="a",
    strL=select(options,isstring(#)); //181216
    tmp=select(strL,contains(["dr","da","do","id"],substring(#,0,2)));
    if(length(tmp)==0,options=append(options,YasenStyle));
    tmp=substring(ax_1,1,length(ax_1)); //181216[2lines]
    if(length(tmp)>0,size=parse(tmp),size=YaSize);
    tmp1=concat(options,[size,YaAngle,YaPosition,YaCut,colorax]);//181216
    tmp=[[xrng_1,org_2],[xrng_2,org_2]];
    Arrowdataseg("axx"+text(AXCOUNT),tmp,tmp1);
    tmp=[[org_1,yrng_1],[org_1,yrng_2]];
    Arrowdataseg("axy"+text(AXCOUNT),tmp,tmp1); //190419
  ,
    tmp=[[xrng_1,org_2],[xrng_2,org_2]];
    tmp1=concat(options,[colorax,"Msg=n"]);//181216,190325
    Listplot("-axx"+text(AXCOUNT),tmp,tmp1); 
    tmp=[[org_1,yrng_1],[org_1,yrng_2]];
    Listplot("-axy"+text(AXCOUNT),tmp,tmp1); 
  );
  AXCOUNT=AXCOUNT+1;
tmp=labelsize*10*1.15; //
tmp1=tmp*0.0352778*0.16;
tmp2=tmp*0.0352778*0.16;
drawtext([xrng_2,org_2-tmp2],"$"+ax_2+"$",size->tmp);
drawtext([org_1-tmp1,yrng_2],"$"+ax_4+"$",size->tmp);
if(indexof(AX_7,"e")>0,tmp1=0,tmp1=1.9*tmp1);
If(indexof(AX_7,"n")>0,tmp2=0,tmp2=1.9*tmp2);
drawtext(org-4*[tmp1,tmp2],ax_6,size->tmp);// 
  if(add==0, //190103
    Addax(0);
  );
);
Arrowdataseg(ptlist):=Arrowdataseg(ptlist,[]); //181110from
Arrowdataseg(Arg1,Arg2):=(
  regional(name);
  if(isstring(Arg1),
    Arrowdataseg(Arg1,Arg2,[]);
  ,
    name="";
    forall(Arg1,
      if(ispoint(#),
        name=name+#.name; //190505
      );
    );
    Arrowdataseg(name,Arg1,Arg2);
  );
);  //181110from
Arrowdataseg(nm,ptlistorg,optionsorg):=(
  regional(options,Ltype,Noflg,opstr,opcindy,eqL,reL,strL,color,size,lineflg,
      flg,cutend,tmp,tmp1,tmp2,pA,pB,pC,angle,segpos,cut,scaley,Ev,Nv,pP,ptlist);
  scaley=SCALEY; //190412
  SCALEY=1; //200114
  ptlist=[];
  forall(ptlistorg,
    if(ispoint(#),tmp=[#.x, #.y], tmp=[#_1,scaley*#_2]);
    ptlist=append(ptlist,tmp);
  );
  pA=ptlist_1; pB=ptlist_2;
  options=optionsorg;
  tmp=Divoptions(options);
  Ltype=tmp_1;
  Noflg=tmp_2;
  eqL=tmp_5;
  reL=tmp_6;
  strL=tmp_7;
  color=tmp_(length(tmp)-2);
  opstr=tmp_(length(tmp)-1);
  opcindy=tmp_(length(tmp));
  size=0.2*YaSize*1/2.54*1000/MilliIn; 
  angle=YaAngle*pi/180;
  segpos=YaPosition;
  cut=YaCut;
  if(length(reL)>=1,
    size=0.2*reL_1*1/2.54*1000/MilliIn; 
  );
  if(length(reL)>=2,
    if(reL_2<2.5,angle=reL_2*YaAngle,angle=reL_2);
    angle=angle*pi/180;
  );
  if(length(reL)>=3,
    segpos=reL_3;
  );
  if(length(reL)>=4,
    cut=reL_4;
  );
  options=remove(options,reL); //191202
  cutend=[0,0];//180719
  lineflg=0;
  forall(eqL,
    tmp=Strsplit(#,"=");
    tmp1=Toupper(substring(tmp_1,0,2));
    tmp2=tmp_2;
    if(tmp1=="CU",//180719from
      tmp2=replace(tmp2,"[","");
      tmp2=replace(tmp2,"]","");
      cutend=tokenize(tmp2,",");
      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);
    );
    if(tmp1=="LI",//190504from
      tmp2=Toupper(substring(tmp2,0,1));
      if(tmp2=="Y",lineflg=1);
    );//190504to
  );
  tmp=pB-pA;
  tmp=tmp/|tmp|;
  pA=ptlist_1+tmp*cutend_1;
  pB=ptlist_2-tmp*cutend_2;
  pP=pA+segpos*(pB-pA);
  Ev=-1/|pB-pA|*(pB-pA); Nv=[-Ev_2, Ev_1];
  tmp1=pP+size*cos(angle)*Ev+size*sin(angle)*Nv;
  tmp2=pP+size*cos(angle)*Ev-size*sin(angle)*Nv;
  pC=pP+(1-cut)*((tmp1+tmp2)/2-pP);
  ArrowheadNumber=ArrowheadNumber+1;
  if(Noflg<2,
    if(lineflg==1,
      Listplot("-arh"+nm,[tmp1,pP,tmp2],append(options,"Msg=n")); //191106
    ,
      Listplot("-arh"+nm,[tmp1,pP,tmp2,pC,tmp1],["dr,0.1","Color="+color,"Msg=n"]); //191106
    fillpoly(parse("arh"+nm),color->color); // 
    );
    if(lineflg==0,
      if(segpos==1,pB=pC); //191202
    );
    Listplot("-ar"+nm,[pA,pB],[Ltype,"Color="+color,"Msg=n"]); 
  );
  SCALEY=scaley; //200114
  [LLcrd(pA),LLcrd(pB)];
);
Ketcindyjsfigure=0;
Ketcindyjsscale=1;

dtxt(dtpos,no,data):=(
 regional(tmp1,tmp2);
 if(isstring(no),tmp1=no,tmp1=text(no));
 if(isstring(data),tmp2=data,tmp2=text(data));
 drawtext(dtpos,tmp1+":"+tmp2,size->15);
);

Dispoption(py,dy,sz):=(
  drawtext([13.5,py],"$x=$",size->sz);
  drawtext([18.3,py],",",size->sz);py=py-dy;
  drawtext([13.5,py],"Num=",size->sz);py=py-dy;
  drawtext([13.5,py],"Exc=",size->sz);py=py-dy;
  drawtext([13.5,py],"Dis=",size->sz);py=py-dy;
  drawtext([13.5,py],"Color=",size->sz);
);

Initinput():=(
 Subsedit(5,"y=");
 Subsedit(6,"-10");
 Subsedit(7,"10");
 Subsedit(8,"100");
 Subsedit(9,"");
 Subsedit(10,"");
 Subsedit(11,"red");
);

Makefundata(fun):=(
  regional(x1,x2,num,exc,dis,col);
  x1=Textedit(6,"-10");
  x2=Textedit(7,"10");
  if((length(x1)>0)&(length(x2)>0),
    x1=Tocindyform(x1);
    x2=Tocindyform(x2);
  );
  num=Textedit(8,"100");
  if(length(num)>0,
    num="Num="+num;
  );
  exc=Textedit(9,"");
  if(length(exc)>0,
    if(indexof(exc,"(")==0,
      if(indexof(exc,"[")==0,
        exc="["+exc+"]";
      );
      exc=parse(exc);
      exc=textformat(exc,6);
      exc=replace(exc,"[[","[");
      exc=replace(exc,"]]","]");
    );
    exc="Ex="+exc;
  );
  dis=Textedit(110,"");
  if(length(dis)>0,
    dis="Dis="+dis;
  );
  col=Textedit(111,"red");
  if(length(col)>0,
    col="Color="+col;
  );
  if(length(fun)>0,
    tmp=[x1,x2,num,exc,dis,col];
    tmp=text(tmp);
    tmp=fun+"&"+substring(tmp,1,length(tmp)-1);
    if(nf<=length(fL),
      fL_nf=tmp;
    ,
      fL=concat(fL,[tmp]);
    );
  );
);

Funrngop(str):=(
  regional(fun,ostr,rng,cst,tstr,x1,x2,op,rng,tmp);
  fun="";rng="";op="";
  tmp=Strsplit(str,"&");
  if(length(tmp)>1,
    fun=tmp_1;
    ostr=tmp_2;
    ostr=Replace(ostr," ","");
    ostr=Strsplit(ostr,",");
    x1=ostr_1; x2=ostr_2;
    op=ostr_(3..(length(ostr)));
    rng="";
    if((length(x1)>0)&(length(x2)>0),
      rng="=["+x1+","+x2+"]";
    );
  );
  [fun,rng,op];
);

Dispfunrngop(n):=(
  regional(fun,rng,op,x1,x2,num,exc,dis,col,tmp);
  tmp=Funrngop(fL_n);
  fun=tmp_1;
  rng=tmp_2;
  op=tmp_3;
  rng=replace(rng,[["[",""],["]",""]]);
  rng=Strsplit(rng,",");
  x1=Tocindyform(rng_1);
  x2=Tocindyform(rng_2);
  tmp=Strsplit(op_1,"=");num=tmp_(-1);
  tmp=Strsplit(op_2,"=");
  if(length(tmp)>0,exc=tmp_(-1),exc="");
  tmp=Strsplit(op_3,"=");
  if(length(tmp)>0,dis=tmp_(-1),dis="");
  tmp=Strsplit(op_4,"=");
  if(length(tmp)>0,col=tmp_(-1),col="");
  Subsedit(5,"y="+fun);
  Subsedit(6,x1);
  Subsedit(7,x2);
  Subsedit(8,num);
  Subsedit(9,exc);
  Subsedit(110,dis);
  Subsedit(111,col);
);

Key2fun():=(
  regional(out);
  out="";
  forall(keyL,
    out=out+#;
  );
  out;
);

Instr(key):=(
  regional(out,tmp,tmp1);
  out=key;
  if(length(key)==2,
    tmp=substring(key,0,1);
    tmp1=substring(key,1,2);
    if((tmp=="L")%(tmp=="n"),
      out=tmp1;
      if(capflg==1,
        if((out>="a")&(out<="z"),
          out=Toupper(out);
        );
      );
    ,
      out=key;
    );
  ,
    if(key=="delete",Delete();out="");
    if(key=="allclear",Allclear();out="");
    if(key=="(SP)",out="(SP)");
  );
  out;
);

Gridpaper():=(
  regional(mv,tmp,tmp1);
  mv=0.3;
  drawtext([XMAX,-mv],"$x$",size->12);
  drawtext([-mv,YMAX],"$y$",size->12);
  draw([XMIN,0],[XMAX,0],color->[0,0,0]);
  draw([0,YMIN],[0,YMAX],color->[0,0,0]);
  tmp=((-10)..(10));
  forall(remove(tmp,[0]),
    tmp1=text(#);
    if(length(tmp1)==1,tmp1=" "+tmp1);
    if(length(tmp1)==2,
      drawtext([#-mv,-2.1*mv],tmp1,size->12);
    ,
      drawtext([#-1.6*mv,-2.1*mv],tmp1,size->12);
    );
  );
  tmp=((-10)..(10));
  forall(remove(tmp,[0]),
    tmp1=text(#);
    if(length(tmp1)==1,tmp1=" "+tmp1);
    if(length(tmp1)==2,
      drawtext([-2.7*mv,#-mv],tmp1,size->12);
    ,
      drawtext([-3.5*mv,#-mv],tmp1,size->12);
    );
  );
);

Delete():=(
  regional(fstr);
  if(length(keyL)>0,
    keyL=keyL_(1..(length(keyL)-1))
  );
  fstr=Key2fun();
  fL_nf=Makefundata(fstr);
  Subsedit(5,"y="+fstr);
  funflg=0;
);

Allclear():=(
  fL_nf="";
  keyL=[];
  Subsedit(5,"y=");
  funflg=0;
);

Newgraph():=(
  fL=[];
  nf=1;
  keyL=[];
  keyLL=[];
  Initinput();
  newgraphflg=0;
);

Addgraph():=(
  nf=nf+1;
  keyLL=append(keyLL,keyL);
  keyL=[];
  Initinput();
  addgraphflg=0;
);

Delgraph():=(
  if(nf==1,
    Newgraph();
  ,
    nf=nf-1;
    fL=fL_(1..nf);
    keyLL=keyLL_(1..nf);
    keyL=keyL_(-1);
    Dispfunrngop(nf);
  );
  delgraphflg=0;
);

fL=[];
nf=1;
keyL=[];
keyLL=[];
newgraphflg=1;
addgraphflg=0;
delgraphflg=0;
funflg=0;
;
</script>
<script id="csdraw" type="text/x-cindyscript">
Ketinit();

Setwindow([-10.5,10.5],[-10.5,10.5]);

Addax(0);

Gridpaper();
Dispoption(-2.8,1.8,16);

if(newgraphflg==1,Newgraph());
if(addgraphflg==1,Addgraph());
if(delgraphflg==1,Delgraph());

drawtext([11,8.6],"$="+text(nf)+"$",size->18);

if(funflg==1,
  str=Instr(name);
  if(length(str)>0,
    keyL=append(keyL,str);//0415
  );
  funflg=0;
);

tmp1=Key2fun();
tmp2=Textedit(5,"");
if(length(tmp1)<length(tmp2),
  tmp=substring(tmp2,length(tmp1),length(tmp2));
  keyL=append(keyL,tmp);
);
fun=Key2fun();
if(length(fun)>0,
  Subsedit(5,"y="+fun);
  tmp=Makefundata(fun);
  fL_nf=tmp;
  npos=length(tmp);
);

fstr="";
texall="";
ctr=1;
forall(1..(length(fL)),
  tmp=Funrngop(fL_#);
  fun=tmp_1;
  rng=tmp_2;
  op=tmp_3;
  if(length(fun)>0,
    fun=Addasterisk(fun);
    cstr=Tocindyform(fun);
    tstr=Totexform(fun);
    texall=texall+tstr+",";
    Plotdata(text(ctr)+"u",cstr+"+0.05","x"+rng,op);
    Plotdata(text(ctr)+"d",cstr+"-0.05","x"+rng,op);
    ctr=ctr+1;
    fstr=fstr+fL_#+";";
  );
);


if(length(texall)>0,
  tmp=Indexall(texall,",");
  tmp=select(tmp,#<40);
  tmp=max(tmp);
  if(tmp==length(texall),
    tmp1=substring(texall,0,length(texall)-1);
    tmp2="";
  ,
    tmp1=substring(texall,0,tmp);
    tmp2=substring(texall,tmp,length(texall)-1);
  );
  drawtext([12,3.5],"$y=\displaystyle "+tmp1+"$",size->18);
  if(length(tmp2)>0,
    drawtext([12,2],"$y=\displaystyle "+tmp2+"$",size->18);
  );
);

Framedata2("1",[[-11,11],[11,14.5]],["nodisp"]);
Shade(["fr1"],["Color=offwhite"]);
Framedata2("2",[[-11,-16],[11,-11]],["nodisp"]);
Shade(["fr2"],["Color=offwhite"]);

Windispg();

;
</script>
    <script type="text/javascript">
var cdy = CindyJS({
  scripts: "cs*",
  use: ["katex"],
  defaultAppearance: {
    dimDependent: 0.7,
    fontFamily: "sans-serif",
    lineSize: 1,
    pointSize: 5.0,
    textsize: 12.0
  },
  angleUnit: "",
  geometry: [
    {name: "SW", type: "Free", pos: [4.0, 4.0, -0.38095238095238093], color: [1.0,1.0,1.0], labeled: false, size: 2.0, border:false },
    {name: "NE", type: "Free", pos: [4.0, 4.0, 0.38095238095238093], color: [1.0,1.0,1.0], labeled: false, size: 2.0, border:false },
    {name: "Text5", type: "EditableText", pos: [4.0, 1.981651376146789, 0.3472519795522442], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 300, text: "y=", textsize: 30.0},
    {name: "Text6", type: "EditableText", pos: [4.0, -0.75177304964539, 0.26844301965386247], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 60, text: "-10", textsize: 16.0},
    {name: "Text8", type: "EditableText", pos: [4.0, -1.1282051282051282, 0.2426311908409911], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 100, text: "100", textsize: 16.0},
    {name: "Text111", type: "EditableText", pos: [4.0, -2.3746031746031746, 0.2403204175948864], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 100, text: "red", textsize: 16.0},
    {name: "Text9", type: "EditableText", pos: [4.0, -1.543408360128617, 0.24341135544176598], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 100, textsize: 16.0},
    {name: "Text7", type: "EditableText", pos: [4.0, -0.5793871866295265, 0.21086610457490035], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 60, text: "10", textsize: 16.0},
    {name: "Text110", type: "EditableText", pos: [4.0, -1.9487179487179487, 0.2426311908409911], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 100, textsize: 16.0},
    {name: "Text115", type: "EditableText", pos: [1.0311111111111109, -4.0, 0.336448584632841], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 1.0, minwidth: 400, textsize: 16.0},
    {name: "A", type: "Free", pos: [4.0, 1.1664212076583385, 0.11148885352339954], color: [0.98, 1.0, 0.62], size: 0.0, border: true },
    {name: "Text32", type: "Button", pos: [4.0, 1.674185463659148, 0.18972664546964718], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 0.8205128205128205, script: "delgraphflg=1;\n", text: "", textsize: 18.0},
    {name: "Text30", type: "Button", pos: [4.0, 1.4811529933481153, 0.16785128945097388], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 0.8974358974358975, script: "newgraphflg=1;", text: "", textsize: 18.0},
    {name: "Text31", type: "Button", pos: [4.0, 1.9190751445086704, 0.21878881948667406], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 1.0], fillalpha: 0.8205128205128205, script: "addgraphflg=1;\n", text: "", textsize: 18.0},
    {name: "Text87", type: "Button", pos: [4.0, -0.15286624203821655, 0.1607238461621852], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"sin(\";\n", text: "sin", textsize: 24.0},
    {name: "Text88", type: "Button", pos: [4.0, -0.5056854934907923, 0.16041795508013748], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"cos(\";\n", text: "cos", textsize: 24.0},
    {name: "Text89", type: "Button", pos: [4.0, -0.8294940812364207, 0.15919556304753782], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"tan(\";", text: "tan", textsize: 24.0},
    {name: "Text90", type: "Button", pos: [4.0, -0.7599993321296454, 0.14585820963760163], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"log(\";\n", text: "log", textsize: 24.0},
    {name: "Text85", type: "Button", pos: [4.0, -0.1245136186770428, 0.14727807693071834], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"fr(\";\n", text: "f r", textsize: 22.0},
    {name: "Text86", type: "Button", pos: [4.0, -0.4615384615384615, 0.14557871450459467], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"sq(\";", text: "s q", textsize: 24.0},
    {name: "Text76", type: "Button", pos: [4.0, -0.42704626334519574, 0.13469916644553243], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"pi\";\n", text: "p i", textsize: 24.0},
    {name: "Text43", type: "Button", pos: [4.0, -0.11657559198542804, 0.13788876419378732], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"Lx\";\n", text: "", textsize: 22.0},
    {name: "Text57", type: "Button", pos: [4.0, -0.117039586919105, 0.1302942023104806], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\",\";\n", text: "", textsize: 24.0, textbold: true},
    {name: "Text17", type: "Button", pos: [4.0, -1.0097087378640777, 0.1397000353420211], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"n7\";\n", text: "", textsize: 24.0},
    {name: "Text19", type: "Button", pos: [4.0, -0.8978417266187051, 0.12422247746959575], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"n9\";\n", text: "", textsize: 24.0},
    {name: "Text18", type: "Button", pos: [4.0, -0.9512195121951219, 0.13160765524598939], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"n8\";\n", text: "", textsize: 24.0},
    {name: "Text14", type: "Button", pos: [4.0, -1.3117932148626819, 0.1394743486936495], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n4\";\n", text: "", textsize: 24.0},
    {name: "Text15", type: "Button", pos: [4.0, -1.2462006079027357, 0.1312076319777645], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n5\";\n", text: "", textsize: 24.0},
    {name: "Text16", type: "Button", pos: [4.0, -1.1724137931034484, 0.1240439968985188], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n6\";\n", text: "", textsize: 24.0},
    {name: "Text12", type: "Button", pos: [4.0, -1.5128593040847202, 0.13061213591735105], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n2\";\n", text: "", textsize: 24.0},
    {name: "Text13", type: "Button", pos: [4.0, -1.430615164520744, 0.12351161922942644], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n3\";\n", text: "", textsize: 24.0},
    {name: "Text10", type: "Button", pos: [4.0, -1.7113402061855671, 0.14834127464152758], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"n0\";\n", text: "", textsize: 24.0},
    {name: "Text56", type: "Button", pos: [4.0, -1.080895008605852, 0.14859659525192606], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"+\";\n", text: "", textsize: 24.0},
    {name: "Text58", type: "Button", pos: [4.0, -1.3931034482758617, 0.14885279627822248], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"-\";\n", text: "", textsize: 24.0},
    {name: "Text11", type: "Button", pos: [4.0, -1.6167471819645733, 0.13902515594423356], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, script: "funflg=1;\nname=\"n1\";\n", text: "", textsize: 24.0},
    {name: "Text54", type: "Button", pos: [4.0, -0.10440456769983687, 0.1234925473774702], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\")\";\n", text: "", textsize: 22.0},
    {name: "Text46", type: "Button", pos: [4.0, -0.6486486486486487, 0.12787319517295478], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"(sp)\";\n", text: "s p c", textsize: 20.0},
    {name: "Text53", type: "Button", pos: [4.0, -0.37662337662337664, 0.12289112263374875], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"(\";\n", text: "", textsize: 22.0},
    {name: "Text52", type: "Button", pos: [4.0, -0.7117437722419929, 0.13469916644553243], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"^(\";\n", text: "^(", textsize: 22.0},
    {name: "Text55", type: "Button", pos: [4.0, -1.162561367684359, 0.1588928703429601], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"*\";\n", text: "", textsize: 24.0},
    {name: "Text60", type: "Button", pos: [4.0, -1.5010141987829615, 0.1592008516344626], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"/\";\n", text: "\b", textsize: 24.0},
    {name: "Text91", type: "Button", pos: [4.0, 0.8373831775700934, 0.14149706830353126], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 0.0, 0.0], fillalpha: 0.5042735042735043, script: "funflg=1;\nname=\"delete\";", text: "Del", textsize: 24.0},
    {name: "Text92", type: "Button", pos: [4.0, 0.7470288624787776, 0.12852450176976102], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 0.0, 0.0], fillalpha: 0.5042735042735043, script: "funflg=1;\nname=\"allclear\";", text: "AC", textsize: 24.0},
    {name: "Text59", type: "Button", pos: [4.0, -1.8278688524590165, 0.1586197109455583], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\".\";", text: "", textsize: 24.0, textbold: true},
    {name: "Text75", type: "Button", pos: [4.0, -0.39137645107794367, 0.12554051665404517], color: [0.0, 0.0, 0.0], fillcolor: [1.0, 1.0, 0.0], fillalpha: 1.0, text_fontfamily: "monospace", script: "funflg=1;\nname=\"L|\";\n", text: "|", textsize: 24.0}
  ],
  ports: [{
    id: "CSCanvas",
    width: 1005,
    height: 495,
    transform: [{visibleRect: [-14.92716109269077, 12.020988136591683, 38.176544741483475, -14.13456846830011]}],
    grid: 1,
    background: "rgb(247,247,247)"
  }],
  csconsole: false,
  use: ["katex"],
  cinderella: {build: 2006, version: [3, 0, 2006]}
});
    </script>
</head>
<body>
    <div id="CSCanvas"></div>
</body>
</html>
